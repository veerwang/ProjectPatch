From bbcabc95dd95463cf762833ad6cbed757a2c0cb9 Mon Sep 17 00:00:00 2001
From: kevin <kevin.wang2004@hotmail.com>
Date: Sun, 19 Jan 2014 21:53:15 +0800
Subject: [PATCH] =?UTF-8?q?=E4=BF=AE=E6=AD=A3libresource=E7=9A=84Makefile?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/EVA11/base/MKlib.mk        |  1 -
 src/EVA11/base/Makefile        | 40 +++-------------------------------------
 src/EVA11/libresource/Makefile | 24 ++++--------------------
 3 files changed, 7 insertions(+), 58 deletions(-)

diff --git a/src/EVA11/base/MKlib.mk b/src/EVA11/base/MKlib.mk
index 755034c..f68153a 100644
--- a/src/EVA11/base/MKlib.mk
+++ b/src/EVA11/base/MKlib.mk
@@ -50,7 +50,6 @@ SEARCH_INCPATH+=-I../libetio/
 endif
 
 ifeq ($(LIBINC_RESOURCE),yes)
-THIRDLIB+=resource
 SEARCH_LIBPATH+=-L../libresource/
 SEARCH_INCPATH+=-I../libresource/
 endif
diff --git a/src/EVA11/base/Makefile b/src/EVA11/base/Makefile
index f2d225b..941a2fb 100644
--- a/src/EVA11/base/Makefile
+++ b/src/EVA11/base/Makefile
@@ -16,12 +16,12 @@ include MKlib.mk
 
 ifeq ($(CMOD),dynamic)
 DYNAMICLIBS=$(THIRDLIB) $(LIBS)
+STATICLIBS=resource
 else
 DYNAMICLIBS:=$(LIBS) 
-STATICLIBS=$(THIRDLIB)
+STATICLIBS=$(THIRDLIB) resource
 endif
 
-TXTJPGS	:=JPGS
 TXTASMS	:=ASMS
 
 TXTOBJS	:=OBJS
@@ -30,7 +30,7 @@ OBJS_DIR:=./$(TXTOBJS)/
 DEPS_DIR:=./$(TXTDEPS)/
 
 SRCS=
-SRCS+=$(wildcard *.cpp *.c $(TXTJPGS)/*.jpg $(TXTJPGS)/*.png $(TXTJPGS)/*.gif)
+SRCS+=$(wildcard *.cpp *.c)
 
 ifeq ($(COMPILE),arm9)
 SRCS+=$(wildcard $(TXTASMS)/*.s)
@@ -78,24 +78,12 @@ $(DEPS_DIR)$(TXTASMS)/%.s.dep: $(TXTASMS)/%.s | depsasmdir
 	sed 's,\(.*\)\.s: *,$(TXTOBJS)/\1.o:,g' < $@.tmp > $@; \
 	$(RM) $@.tmp
 
-$(DEPS_DIR)$(TXTJPGS)/%.jpg.dep: $(TXTJPGS)/%.jpg | depsjpegdir
-	@set -e;
-
-$(DEPS_DIR)$(TXTJPGS)/%.png.dep: $(TXTJPGS)/%.png | depsjpegdir
-	@set -e;
-
-$(DEPS_DIR)$(TXTJPGS)/%.gif.dep: $(TXTJPGS)/%.gif | depsjpegdir
-	@set -e;
-
 depsdir:
 	@mkdir -p $(DEPS_DIR)
 
 depsasmdir:
 	@mkdir -p $(DEPS_DIR)$(TXTASMS)
 
-depsjpegdir:
-	@mkdir -p $(DEPS_DIR)$(TXTJPGS)
-
 -include $(DEPS)
 
 $(EXEC): $(OBJS)
@@ -110,34 +98,12 @@ $(OBJS_DIR)%.cpp.o: %.cpp | objsdir
 $(OBJS_DIR)$(TXTASMS)%.s.o: $(TXTASMS)/%.s | objsasmsdir
 	$(AS) $< -o $@
 
-$(OBJS_DIR)$(TXTJPGS)/%.jpg.o: $(TXTJPGS)/%.jpg | objsjpegdir
-	$(makejpegresource)
-
-$(OBJS_DIR)$(TXTJPGS)/%.png.o: $(TXTJPGS)/%.png | objsjpegdir
-	$(makejpegresource)
-
-$(OBJS_DIR)$(TXTJPGS)/%.gif.o: $(TXTJPGS)/%.gif | objsjpegdir
-	$(makejpegresource)
-
-ifeq ($(COMPILE),arm9)
-define makejpegresource
-	$(OBJCOPY) -I binary -O elf32-littlearm -B arm $< $@
-endef
-else
-define makejpegresource
-	$(OBJCOPY) -I binary -O elf32-i386 -B i386 $< $@
-endef
-endif
-
 objsdir:
 	@mkdir -p $(OBJS_DIR)
 
 objsasmsdir:
 	@mkdir -p $(OBJS_DIR)$(TXTASMS)
 
-objsjpegdir:
-	@mkdir -p $(OBJS_DIR)$(TXTJPGS)
-
 .PHONY: clean
 clean:
 	$(RM) -rf $(OBJS_DIR) $(DEPS_DIR) $(EXEC)
diff --git a/src/EVA11/libresource/Makefile b/src/EVA11/libresource/Makefile
index 71c04d3..82ad87c 100644
--- a/src/EVA11/libresource/Makefile
+++ b/src/EVA11/libresource/Makefile
@@ -9,9 +9,6 @@
 #
 ###########################################################
 LIBNAME  := libresource
-SONAME   := $(LIBNAME).so.0
-REALNAME := $(LIBNAME).so.0.0.0
-LINKNAME := $(LIBNAME).so
 STATICLIB:= $(LIBNAME).a
 
 TXTOBJS  :=OBJS
@@ -26,20 +23,8 @@ DEPS	 :=$(SRCS:=.dep)
 OBJS	 :=$(addprefix $(OBJS_DIR),$(OBJS))
 DEPS	 :=$(addprefix $(DEPS_DIR),$(DEPS))
 
-ifeq 	($(COMPILE),arm9)
-COMPILE_FLAG = -O2 -std=gnu++0x -fPIC -DPIC -march=armv4t
-export DFLAG  = -DARM9
-else ifeq ($(COMPILE),x86)
-COMPILE_FLAG = -O2 -std=gnu++0x -fPIC -DPIC
-export DFLAG = -DX86
-endif
-
-LIBS:=$(LIBS)
-STATICLIBS:=
-
-all: $(DEPS) $(REALNAME)
-	@echo "build $(LIBNAME) ..."
-	@ln -sf $(REALNAME) $(SONAME);ln -sf $(REALNAME) $(LINKNAME)
+all: $(DEPS) $(STATICLIB)
+	@echo "build $(STATICLIB) ..."
 
 $(DEPS_DIR)%.jpg.dep: %.jpg | depsjpegdir
 	@set -e;
@@ -55,8 +40,7 @@ depsjpegdir:
 
 -include $(DEPS)
 
-$(REALNAME): $(OBJS)
-	$(CPP) -fPIC -DPIC -shared -Wl,-soname -Wl,$(SONAME) -o $@ $^ -Wl,-Bdynamic $(addprefix -l,$(LIBS)) -Wl,-Bstatic $(addprefix -l,$(STATICLIBS)) -Wl,-Bdynamic
+$(STATICLIB): $(OBJS)
 	$(AR) -r $(STATICLIB) $^
 	$(RANLIB) $(STATICLIB)
 
@@ -84,4 +68,4 @@ objsjpegdir :
 
 .PHONY: clean
 clean:
-	$(RM) -rf $(OBJS_DIR) $(DEPS_DIR) $(REALNAME) $(LINKNAME) $(SONAME) $(STATICLIB)
+	$(RM) -rf $(OBJS_DIR) $(DEPS_DIR) $(STATICLIB)
-- 
1.8.5.2

