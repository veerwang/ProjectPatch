From ed86c8edacf2232b4bfda639229b6cd9117d5889 Mon Sep 17 00:00:00 2001
From: kevin <kevin.wang2004@hotmail.com>
Date: Tue, 7 Jan 2014 09:49:48 +0800
Subject: [PATCH 1/2] =?UTF-8?q?=E4=BF=AE=E6=AD=A3=E4=B8=80=E4=BA=9Bbug?=
 =?UTF-8?q?=E4=BD=BF=E4=B9=8B=E8=83=BD=E5=A4=9F=E5=9C=A8arm9=E5=B9=B3?=
 =?UTF-8?q?=E5=8F=B0=E4=B8=8B=E8=BF=9B=E8=A1=8C=E7=BC=96=E8=AF=91?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/EVA11/Basewin.cpp         |  6 ++++++
 src/EVA11/CalculateCenter.cpp |  2 +-
 src/EVA11/Helpwin.cpp         |  4 ++++
 src/EVA11/Logic.cpp           | 11 +++++++++++
 src/EVA11/Logic.h             |  3 +++
 src/EVA11/Mainwin.cpp         |  3 +++
 src/EVA11/Video.h             |  2 +-
 7 files changed, 29 insertions(+), 2 deletions(-)

diff --git a/src/EVA11/Basewin.cpp b/src/EVA11/Basewin.cpp
index dcbc091..47d9634 100644
--- a/src/EVA11/Basewin.cpp
+++ b/src/EVA11/Basewin.cpp
@@ -318,6 +318,9 @@ void Basewin::DrawBottomFocus(Graphic& g,int index)
 		m_BomButton[index-1]->Drawme(g);
 		m_BottomFocus = index;
 	}
+#ifdef X86
+	g.Update_Rect(0,0,640,480);
+#endif
 }
 
 /* 
@@ -343,6 +346,9 @@ void Basewin::Restore_Screen_From_Memory(Graphic& g)
 	g.Restore_Disp_Area(0,0,639,479,m_Gmem);   			/* restore the graphic buffer */
 	delete[] m_Gmem;                           			/* release the buffer */
 	m_Gmem = NULL;
+#ifdef X86
+	g.Update_Rect(0,0,640,480);
+#endif
 }
 
 /* 
diff --git a/src/EVA11/CalculateCenter.cpp b/src/EVA11/CalculateCenter.cpp
index 9cd0e0b..7c84dac 100644
--- a/src/EVA11/CalculateCenter.cpp
+++ b/src/EVA11/CalculateCenter.cpp
@@ -23,7 +23,7 @@
 
 struct CalculateCenter::PImpl
 {
-#ifdef ARM
+#ifdef ARM9
 	const double		m_cPI = 3.1415926;
 #endif
 
diff --git a/src/EVA11/Helpwin.cpp b/src/EVA11/Helpwin.cpp
index 7597543..1378c3e 100644
--- a/src/EVA11/Helpwin.cpp
+++ b/src/EVA11/Helpwin.cpp
@@ -100,6 +100,10 @@ void Helpwin::Drawme(Graphic& g)
 		delete m_Jpeg;
 		m_Jpeg = NULL;
 	}
+
+#ifdef X86
+	g.Update_Rect(0,0,640,480);
+#endif
 }
 
 /* 
diff --git a/src/EVA11/Logic.cpp b/src/EVA11/Logic.cpp
index 4167d33..a3d4626 100644
--- a/src/EVA11/Logic.cpp
+++ b/src/EVA11/Logic.cpp
@@ -984,3 +984,14 @@ int Logic::Get_ADC_Handle()
 	return m_ADC_fd;
 #endif
 }
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Set_Mainwin_Point
+ *  Description:  Set the Mainwin Point 
+ * =====================================================================================
+ */
+void Logic::Set_Mainwin_Point(Mainwin* p)
+{
+	m_pMainwin = p;
+}
diff --git a/src/EVA11/Logic.h b/src/EVA11/Logic.h
index 1a7c10e..8d9e3ae 100644
--- a/src/EVA11/Logic.h
+++ b/src/EVA11/Logic.h
@@ -31,6 +31,7 @@ class Algorithm;
 class Device;
 class Global;
 class DataRepo;
+class Mainwin;
 
 class Logic
 {
@@ -67,6 +68,7 @@ class Logic
 		bool Load_Data_From_File(const char*,short *,int);
 
 		int Get_ADC_Handle();
+		void Set_Mainwin_Point(Mainwin* p);
 	protected:
 	private:
 		Logic ();
@@ -114,5 +116,6 @@ class Logic
 		Global			                *m_gp;
 		DataRepo		                *m_repo;
 		Graphic					*m_g;
+		Mainwin					*m_pMainwin;
 }; /* -----  end of class Logic  ----- */
 #endif   /* ----- #ifndef _Logic_INC  ----- */
diff --git a/src/EVA11/Mainwin.cpp b/src/EVA11/Mainwin.cpp
index 38fd99a..5ab7fe4 100644
--- a/src/EVA11/Mainwin.cpp
+++ b/src/EVA11/Mainwin.cpp
@@ -366,6 +366,9 @@ void Mainwin::Init_Variables()
 	m_SubMenuMaxNo[6] = 4;
 
 	m_PauseFlag       = false;
+
+	Logic* lo = Logic::Instance();
+	lo->Set_Mainwin_Point(this);
 }
 
 /* 
diff --git a/src/EVA11/Video.h b/src/EVA11/Video.h
index 7a9f2d4..e992c0e 100644
--- a/src/EVA11/Video.h
+++ b/src/EVA11/Video.h
@@ -69,7 +69,7 @@ class Video
 
 		void Show_Video_Info();
 	private:
-#ifdef ARM
+#ifdef ARM9
 		constexpr static double	m_FactR = static_cast<double>(31) / static_cast<double>(255);
 		constexpr static double	m_FactG = static_cast<double>(63) / static_cast<double>(255);
 		constexpr static double	m_FactB = static_cast<double>(31) / static_cast<double>(255);
-- 
1.8.5.1

