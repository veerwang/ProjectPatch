From 96f539e7bb71d48740af0a494103d51bac2a0c28 Mon Sep 17 00:00:00 2001
From: kevin <kevin.wang2004@hotmail.com>
Date: Tue, 15 Apr 2014 17:38:55 +0800
Subject: [PATCH 3/4] =?UTF-8?q?=E5=B0=86=E5=A2=9E=E7=9B=8A=E6=AF=94?=
 =?UTF-8?q?=E5=88=86=E6=88=90x=E6=96=B9=E5=90=91=E4=B8=8Ey=E6=96=B9?=
 =?UTF-8?q?=E5=90=91?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/EVA11/base/Algorithm.cpp            |  33 ++++
 src/EVA11/base/Algorithm.h              |  26 ++-
 src/EVA11/base/CZKPanel.cpp             |   3 +
 src/EVA11/base/ColorPanel.cpp           |   2 +-
 src/EVA11/base/ConcreteDataProcess.cpp  |  25 ++-
 src/EVA11/base/DZKPanel.cpp             |   1 +
 src/EVA11/base/DebugView.cpp            |   2 +-
 src/EVA11/base/DetectView.cpp           |   2 +-
 src/EVA11/base/FreeType.cpp             |  11 ++
 src/EVA11/base/FreeType.h               |   1 +
 src/EVA11/base/Global.cpp               |  41 +++++
 src/EVA11/base/Global.h                 |   8 +
 src/EVA11/base/Initfacade.cpp           |   4 +-
 src/EVA11/base/Language/Language.cpp    |   8 +
 src/EVA11/base/Language/ProjectGBText.h |   9 +
 src/EVA11/base/Mainwin.cpp              | 112 +++++++++++-
 src/EVA11/base/OZKPanel.cpp             |   5 +-
 src/EVA11/base/OZKPanel.h               |   3 +-
 src/EVA11/base/Process.cpp              | 294 +++++++++++++++++++++++++++++---
 src/EVA11/base/Sinscreen.cpp            |  80 +++++++++
 src/EVA11/base/Sinscreen.h              |   2 +
 src/EVA11/base/ZKPanel.cpp              |   1 +
 src/EVA11/base/ZScreen.cpp              | 111 ++++++++++--
 src/EVA11/base/ZScreen.h                |  17 ++
 src/EVA11/base/main.h                   |   2 +-
 25 files changed, 742 insertions(+), 61 deletions(-)

diff --git a/src/EVA11/base/Algorithm.cpp b/src/EVA11/base/Algorithm.cpp
index 156108e..783330a 100644
--- a/src/EVA11/base/Algorithm.cpp
+++ b/src/EVA11/base/Algorithm.cpp
@@ -62,6 +62,19 @@ Algorithm* Algorithm::Instance()
 		 *-----------------------------------------------------------------------------*/
 		m_Instance.get()->Init_Digital_Filter_Value(Global::CHANCOUNT);
 		m_Instance.get()->m_fGainPercent = 1.0;
+
+		m_Instance.get()->m_CompositeGainPercent_X
+			                         = 1.0;
+		m_Instance.get()->m_CompositeGainPercent_Y
+			                         = 1.0;
+		m_Instance.get()->m_DoubleGainPercent_X   
+			                         = 1.0;
+		m_Instance.get()->m_DoubleGainPercent_Y   
+			                         = 1.0;
+		m_Instance.get()->m_SingleGainPercent_X   
+			                         = 1.0;
+		m_Instance.get()->m_SingleGainPercent_Y   
+			                         = 1.0;
 	}
 	return m_Instance.get();
 }
@@ -612,6 +625,26 @@ void Algorithm::Calculate_Gain_Ratio(int value)
 
 /* 
  * ===  FUNCTION  ======================================================================
+ *         Name:  Calculate_All_Gain_Ratio
+ *  Description:  Calculate All Gain Ratio
+ * =====================================================================================
+ */
+void Algorithm::Calculate_All_Gain_Ratio()
+{
+	Global *gp  = Global::Instance();
+
+	m_CompositeGainPercent_X  =  static_cast<double>(gp->CompositeGainRatio_X) / 10;
+	m_CompositeGainPercent_Y  =  static_cast<double>(gp->CompositeGainRatio_Y) / 10;
+	m_DoubleGainPercent_X     =  static_cast<double>(gp->DoubleGainRatio_X) / 10;
+	m_DoubleGainPercent_Y     =  static_cast<double>(gp->DoubleGainRatio_Y) / 10;
+	m_SingleGainPercent_X     =  static_cast<double>(gp->SingleGainRatio_X) / 10;
+	m_SingleGainPercent_Y     =  static_cast<double>(gp->SingleGainRatio_Y) / 10;
+	m_CrossGainPercent_X      =  static_cast<double>(gp->CrossGainRatio_X) / 10;
+	m_CrossGainPercent_Y      =  static_cast<double>(gp->CrossGainRatio_Y) / 10;
+}
+
+/* 
+ * ===  FUNCTION  ======================================================================
  *         Name:  Polynomial_Fitting
  *  Description:  Calculate the Polynomial factor 
  *        terms:  ex.: x^4 + x^3 + x^2   
diff --git a/src/EVA11/base/Algorithm.h b/src/EVA11/base/Algorithm.h
index 16fe199..b2f5add 100644
--- a/src/EVA11/base/Algorithm.h
+++ b/src/EVA11/base/Algorithm.h
@@ -74,10 +74,24 @@ class Algorithm
 				     const int& x2,const int& y2,
 				     double& sx,double& sy);
 		int Calculate_Angle(const int& x,const int& y);
-		void Calculate_Gain_Ratio(int);
 
+		void Calculate_Gain_Ratio(int);
 		inline double Gain_Ratio(double yvalue){ return yvalue * m_fGainPercent; }
 
+		void Calculate_All_Gain_Ratio();
+
+		inline double Composite_Gain_Ratio_X(double value){ return value * m_CompositeGainPercent_X; }
+		inline double Composite_Gain_Ratio_Y(double value){ return value * m_CompositeGainPercent_Y; }
+
+		inline double Double_Gain_Ratio_X(double value){ return value * m_DoubleGainPercent_X; }
+		inline double Double_Gain_Ratio_Y(double value){ return value * m_DoubleGainPercent_Y; }
+
+		inline double Single_Gain_Ratio_X(double value){ return value * m_SingleGainPercent_X; }
+		inline double Single_Gain_Ratio_Y(double value){ return value * m_SingleGainPercent_Y; }
+
+		inline double Cross_Gain_Ratio_X(double value){ return value * m_CrossGainPercent_X; }
+		inline double Cross_Gain_Ratio_Y(double value){ return value * m_CrossGainPercent_Y; }
+
 		bool Polynomial_Fitting(double* x,double* y,int datalen,int terms,double* c);
 	protected:
 	private:
@@ -105,8 +119,18 @@ class Algorithm
 		double m_Tan[180];
 		double m_Tab_Sqrt[MAXTABLELONG][MAXTABLELONG];                                  /* The Tables of sqr(A*2 + B*2) for scale calculate */
 		double m_Tab_XX[MAXTABLELONG][MAXTABLELONG];                                    /* The Tables of A*2 + B*2 for scale calculate      */
+
 		double m_fGainPercent;
 
+		double m_CompositeGainPercent_X;
+		double m_CompositeGainPercent_Y;
+		double m_DoubleGainPercent_X;
+		double m_DoubleGainPercent_Y;
+		double m_SingleGainPercent_X;
+		double m_SingleGainPercent_Y;
+		double m_CrossGainPercent_X;
+		double m_CrossGainPercent_Y;
+
 		std::vector<DFilter *> m_DFBuffer;                                              /* Only used for Digital Filter                     */
 }; /* -----  end of class Algorithm  ----- */
 #endif
diff --git a/src/EVA11/base/CZKPanel.cpp b/src/EVA11/base/CZKPanel.cpp
index 5145873..ed44bfb 100644
--- a/src/EVA11/base/CZKPanel.cpp
+++ b/src/EVA11/base/CZKPanel.cpp
@@ -61,6 +61,7 @@ void CZKPanel::Init_GUI(Graphic& g)
 {
 	DZKPanel::Init_GUI(g);
 	m_gp->bCompositeSrcPause = false;
+
 }
 
 /* 
@@ -167,6 +168,8 @@ void CZKPanel::Init_ZScreen_Object(Graphic& g)
 		m_Zscreen[i]->Set_ID(i+1);
 
 		Refresh_ZKScreen_Focus(g,false);
+
+		m_Zscreen[i]->Set_Ratio_Gain_Type(Zscreen::COMPISITE);
 	}
 
 	m_Chart[0] = new Chart(2,313,530,65);
diff --git a/src/EVA11/base/ColorPanel.cpp b/src/EVA11/base/ColorPanel.cpp
index 8c42669..9174d40 100644
--- a/src/EVA11/base/ColorPanel.cpp
+++ b/src/EVA11/base/ColorPanel.cpp
@@ -323,7 +323,7 @@ void ColorPanel::Switch_Panel()
 
 	for ( int ch=0;ch<m_gp->ColorSpotScanChannels;ch++ )
 	{
-		m_gp->ProbeFun[ch] = 1;			// ECT
+//		m_gp->ProbeFun[ch] = 1;			// ECT
 		device->Write_Para_SignalID(ch,m_gp->ProbeFun[ch],m_gp->FreqIndex[ch]+1);
 		device->Write_Para_LowFilter(ch,m_gp->LoFilter[ch]);
 		device->Write_Para_HiFilter(ch,m_gp->HiFilter[ch]);
diff --git a/src/EVA11/base/ConcreteDataProcess.cpp b/src/EVA11/base/ConcreteDataProcess.cpp
index ce5b927..d5aa678 100644
--- a/src/EVA11/base/ConcreteDataProcess.cpp
+++ b/src/EVA11/base/ConcreteDataProcess.cpp
@@ -53,7 +53,10 @@ void ZKDataProcess::Data_Process()
 		{
 			m_Double_X[index] = ( m_ETData[index<<1] )     * m_gp->SoftGain[index];
 			m_Double_Y[index] = ( 0 - m_ETData[(index<<1)+1] ) * m_gp->SoftGain[index];
-			m_Double_Y[index] = m_alg->Gain_Ratio(m_Double_Y[index]);
+
+			m_Double_X[index] = m_alg->Single_Gain_Ratio_X(m_Double_X[index]);
+			m_Double_Y[index] = m_alg->Single_Gain_Ratio_Y(m_Double_Y[index]);
+
 			m_alg->Rotation(m_gp->Degree[index],m_Double_X[index],
 					m_Double_Y[index],m_ET_X[index],m_ET_Y[index]);
 			m_ET_Y[index] = 0 - m_ET_Y[index];
@@ -111,7 +114,10 @@ void DZKDataProcess::Data_Process()
 		{
 			m_Double_X[index] = ( m_ETData[index<<1] ) * m_gp->SoftGain[index];
 			m_Double_Y[index] = ( 0 - m_ETData[(index<<1)+1] ) * m_gp->SoftGain[index];
-			m_Double_Y[index] = m_alg->Gain_Ratio(m_Double_Y[index]);
+
+			m_Double_X[index] = m_alg->Double_Gain_Ratio_X(m_Double_X[index]);
+			m_Double_Y[index] = m_alg->Double_Gain_Ratio_Y(m_Double_Y[index]);
+
 			m_alg->Rotation(m_gp->Degree[index],m_Double_X[index],
 					m_Double_Y[index],m_ET_X[index],m_ET_Y[index]);
 			m_ET_Y[index] = 0 - m_ET_Y[index];
@@ -128,7 +134,10 @@ void DZKDataProcess::Data_Process()
 	{
 		m_Double_X[index] = ( m_ETData[index<<1] ) * m_gp->SoftMixGain[index-2];
 		m_Double_Y[index] = ( 0 - m_ETData[(index<<1)+1] ) * m_gp->SoftMixGain[index-2];
-		m_Double_Y[index] = m_alg->Gain_Ratio(m_Double_Y[index]);
+
+		m_Double_X[index] = m_alg->Double_Gain_Ratio_X(m_Double_X[index]);
+		m_Double_Y[index] = m_alg->Double_Gain_Ratio_Y(m_Double_Y[index]);
+
 		m_alg->Rotation(m_gp->MixDegree[index-2],m_Double_X[index],
 				m_Double_Y[index],m_ET_X[index],m_ET_Y[index]);
 		m_ET_Y[index] = 0 - m_ET_Y[index];
@@ -187,7 +196,10 @@ void CZKDataProcess::Data_Process()
 		{
 			m_Double_X[index] = ( m_ETData[index<<1] ) * m_gp->SoftGain[index];
 			m_Double_Y[index] = ( 0 - m_ETData[(index<<1)+1] ) * m_gp->SoftGain[index];
-			m_Double_Y[index] = m_alg->Gain_Ratio(m_Double_Y[index]);
+
+			m_Double_X[index] = m_alg->Composite_Gain_Ratio_X(m_Double_X[index]);
+			m_Double_Y[index] = m_alg->Composite_Gain_Ratio_Y(m_Double_Y[index]);
+
 			m_alg->Rotation(m_gp->Degree[index],m_Double_X[index],
 					m_Double_Y[index],m_ET_X[index],m_ET_Y[index]);
 			m_ET_Y[index] = 0 - m_ET_Y[index];
@@ -350,7 +362,10 @@ void OZKDataProcess::Data_Process()
 		{
 			m_Double_X[index] = ( m_ETData[index<<1] )     * m_gp->SoftGain[index];
 			m_Double_Y[index] = ( 0 - m_ETData[(index<<1)+1] ) * m_gp->SoftGain[index];
-			m_Double_Y[index] = m_alg->Gain_Ratio(m_Double_Y[index]);
+
+			m_Double_X[index] = m_alg->Cross_Gain_Ratio_X(m_Double_X[index]);
+			m_Double_Y[index] = m_alg->Cross_Gain_Ratio_Y(m_Double_Y[index]);
+
 			m_alg->Rotation(m_gp->Degree[index],m_Double_X[index],
 					m_Double_Y[index],m_ET_X[index],m_ET_Y[index]);
 			m_ET_Y[index] = 0 - m_ET_Y[index];
diff --git a/src/EVA11/base/DZKPanel.cpp b/src/EVA11/base/DZKPanel.cpp
index 5f9d7d0..714e42c 100644
--- a/src/EVA11/base/DZKPanel.cpp
+++ b/src/EVA11/base/DZKPanel.cpp
@@ -246,6 +246,7 @@ void DZKPanel::Init_ZScreen_Object(Graphic& g)
 		m_Zscreen[i]->Set_Color(Zscreen::LA_POINT_COLOR,g_SCTX_CO);
 		m_Zscreen[i]->Set_Color(Zscreen::LA_FOCUS_COLOR,g_SCTX_CO);
 		m_Zscreen[i]->Set_ID(i+1);
+		m_Zscreen[i]->Set_Ratio_Gain_Type(Zscreen::DOUBLE);
 
 		Refresh_ZKScreen_Focus(g,false);
 	}
diff --git a/src/EVA11/base/DebugView.cpp b/src/EVA11/base/DebugView.cpp
index 3f719cb..1f9963e 100644
--- a/src/EVA11/base/DebugView.cpp
+++ b/src/EVA11/base/DebugView.cpp
@@ -161,7 +161,7 @@ void DebugView::Switch_View()
  */
 void DebugView::Show_Help_System(Graphic& g,int x,int y)
 {
-	short bgcolor = g_BUBGNO_CO,fgcolor    = g_BUTXNO_CO;
+	short bgcolor = g_BUBGNO_CO,fgcolor = g_BUTXNO_CO;
 	Language  *pl = Language::Instance();
 
 	FreeType *font = FreeType::Instance();
diff --git a/src/EVA11/base/DetectView.cpp b/src/EVA11/base/DetectView.cpp
index 809fd51..132e6c4 100644
--- a/src/EVA11/base/DetectView.cpp
+++ b/src/EVA11/base/DetectView.cpp
@@ -77,7 +77,7 @@ void DetectView::Init_GUI(Graphic& g)
 
 	m_Panel[3] = new DZKPanel(m_X,m_Y,m_Width,m_Heigh);
 	m_Panel[3]->Init_GUI(g);
-
+	
 	m_Panel[4] = new OZKPanel(m_X,m_Y,m_Width,m_Heigh);
 	m_Panel[4]->Init_GUI(g);
 
diff --git a/src/EVA11/base/FreeType.cpp b/src/EVA11/base/FreeType.cpp
index 2891b37..50a0bb4 100644
--- a/src/EVA11/base/FreeType.cpp
+++ b/src/EVA11/base/FreeType.cpp
@@ -436,6 +436,17 @@ void FreeType::Text(int x,int y,const char* str)
 	cstr = NULL;
 }
 
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Get_Font_Size
+ *  Description:  Return the Font Size 
+ * =====================================================================================
+ */
+int  FreeType::Get_Font_Size()
+{
+	return m_pimpl->m_fontsize;
+}
+
 //void  FreeType::Test(Graphic& g)
 //{
 //	char utf_16le[] = "‰∏≠ÂõΩGB‰∏≠Âçé‰∫∫Ê∞ëÂÖ±ÂíåÂõΩ"; 
diff --git a/src/EVA11/base/FreeType.h b/src/EVA11/base/FreeType.h
index 9c554e6..8a56db4 100644
--- a/src/EVA11/base/FreeType.h
+++ b/src/EVA11/base/FreeType.h
@@ -45,6 +45,7 @@ class FreeType
 		void Set_Transparce(bool value);
 		bool Get_Transparce();
 		void Set_Font_Size( int value );
+		int  Get_Font_Size();
 		void Text(int x,int y,const char*);
 
 //		void  Test(Graphic& g);
diff --git a/src/EVA11/base/Global.cpp b/src/EVA11/base/Global.cpp
index a1b03b7..9a28040 100644
--- a/src/EVA11/base/Global.cpp
+++ b/src/EVA11/base/Global.cpp
@@ -322,6 +322,23 @@ void Global::Init_Global_Variables()
 
 	GainRatio       = 10;
 	AScanSpeed      = 16;
+
+	CompositeGainRatio_X
+		        = 10;
+	CompositeGainRatio_Y
+		        = 10;
+	DoubleGainRatio_X
+		        = 10;
+	DoubleGainRatio_Y
+		        = 10;
+	SingleGainRatio_X
+		        = 10;
+	SingleGainRatio_Y
+		        = 10;
+	CrossGainRatio_X
+		        = 10;
+	CrossGainRatio_Y
+		        = 10;
 	/*    ----------------- don't need save into flash -----------------    */
 
 	DebugChan	     = 0;
@@ -533,6 +550,18 @@ std::ofstream& operator<<(std::ofstream& oo,const Global& ob)
 
 	oo<<ob.GainRatio<<' ';
 	oo<<ob.AScanSpeed<<' ';
+
+	oo<<ob.CompositeGainRatio_X<<' ';
+	oo<<ob.CompositeGainRatio_Y<<' ';
+
+	oo<<ob.DoubleGainRatio_X<<' ';
+	oo<<ob.DoubleGainRatio_Y<<' ';
+
+	oo<<ob.SingleGainRatio_X<<' ';
+	oo<<ob.SingleGainRatio_Y<<' ';
+
+	oo<<ob.CrossGainRatio_X<<' ';
+	oo<<ob.CrossGainRatio_Y<<' ';
 	return oo;
 }
 
@@ -724,6 +753,18 @@ std::ifstream& operator>>(std::ifstream& io,Global& ob)
 
 	io>>ob.GainRatio;
 	io>>ob.AScanSpeed;
+
+	io>>ob.CompositeGainRatio_X;
+	io>>ob.CompositeGainRatio_Y;
+
+	io>>ob.DoubleGainRatio_X;
+	io>>ob.DoubleGainRatio_Y;
+
+	io>>ob.SingleGainRatio_X;
+	io>>ob.SingleGainRatio_Y;
+
+	io>>ob.CrossGainRatio_X;
+	io>>ob.CrossGainRatio_Y;
 	return io;
 }
 
diff --git a/src/EVA11/base/Global.h b/src/EVA11/base/Global.h
index 10a4f6a..0453565 100644
--- a/src/EVA11/base/Global.h
+++ b/src/EVA11/base/Global.h
@@ -155,6 +155,14 @@ class Global
 		int			GainRatio;
 		int			AScanSpeed;
 
+		int                     CompositeGainRatio_X;
+		int                     CompositeGainRatio_Y;
+		int 			DoubleGainRatio_X;
+		int 			DoubleGainRatio_Y;
+		int 			SingleGainRatio_X;
+		int 			SingleGainRatio_Y;
+		int 			CrossGainRatio_X;
+		int 			CrossGainRatio_Y;
 
 		/* ---------- don't need to save ---------- */
 
diff --git a/src/EVA11/base/Initfacade.cpp b/src/EVA11/base/Initfacade.cpp
index ac24d5f..0b83291 100644
--- a/src/EVA11/base/Initfacade.cpp
+++ b/src/EVA11/base/Initfacade.cpp
@@ -68,7 +68,7 @@ bool Initfacade::Standard_ET_System_Init()
 
 	Splashscreen *splash = new Splashscreen(150,110,340,260);
 	splash->Drawme(*g);
-	splash->Show_Info(*g,"Starting the EVA-11 System");
+	splash->Show_Info(*g,"Starting the Smart2005A System");
 
 	lo = Logic::Instance();
 	lo->Init_Hardware(*g);
@@ -96,6 +96,8 @@ bool Initfacade::Standard_ET_System_Init()
 
 	alg->Calculate_Gain_Ratio(gp->GainRatio);
 
+	alg->Calculate_All_Gain_Ratio();
+
 	splash->Show_Info(*g,"Init Hardware and D-Buffer");
 	dpo = DataRepo::Instance();
 	lo->Set_Global_Variables_Into_System();
diff --git a/src/EVA11/base/Language/Language.cpp b/src/EVA11/base/Language/Language.cpp
index 756ad9f..b9eb0b0 100644
--- a/src/EVA11/base/Language/Language.cpp
+++ b/src/EVA11/base/Language/Language.cpp
@@ -472,6 +472,10 @@ char const *Language::Get_EN_Text(int index)
 			return CLEANBUFFER_EN;
 		case CHANNELSCOUNT:
 			return CHANNELSCOUNT_EN;
+		case XGAINRATIO:
+			return XGAINRATIO_EN;
+		case YGAINRATIO:
+			return YGAINRATIO_EN;
 		default:
 			return NONE_EN;
 	}
@@ -898,6 +902,10 @@ char const *Language::Get_CN_Text(int index)
 			return CLEANBUFFER_CN;
 		case CHANNELSCOUNT:
 			return CHANNELSCOUNT_CN;
+		case XGAINRATIO:
+			return XGAINRATIO_CN;
+		case YGAINRATIO:
+			return YGAINRATIO_CN;
 		default:
 			return NONE_CN;
 	}
diff --git a/src/EVA11/base/Language/ProjectGBText.h b/src/EVA11/base/Language/ProjectGBText.h
index 1f132f5..abf8a49 100644
--- a/src/EVA11/base/Language/ProjectGBText.h
+++ b/src/EVA11/base/Language/ProjectGBText.h
@@ -287,6 +287,9 @@
 
 #define CHANNELSCOUNT_CN            "Õ®µ¿ ˝¡ø"
 
+#define XGAINRATIO_CN               "X‘ˆ“Ê±»"
+#define YGAINRATIO_CN               "Y‘ˆ“Ê±»"
+
 #define	NONE_CN			    "  "
 /* ********************************************************************  */
 
@@ -554,6 +557,9 @@
 
 #define CHANNELSCOUNT_EN            "Channels Count"
 
+#define XGAINRATIO_EN               "X Gain Ratio"
+#define YGAINRATIO_EN               "Y Gain Ratio"
+
 #define	NONE_EN			    "  "
 /* ********************************************************************  */
 
@@ -823,6 +829,9 @@
 
 #define CHANNELSCOUNT		    208
 
+#define XGAINRATIO		    209
+#define YGAINRATIO	            210
+
 #define	NONE			    999
 
 #endif
diff --git a/src/EVA11/base/Mainwin.cpp b/src/EVA11/base/Mainwin.cpp
index 3f94176..43273aa 100644
--- a/src/EVA11/base/Mainwin.cpp
+++ b/src/EVA11/base/Mainwin.cpp
@@ -1084,13 +1084,56 @@ void Mainwin::Refresh_Normal_Label_Content_2_ColorPanel(Graphic& g,int sub)
 				}
 			}
 			break;
-		case 3:
 		case 2:
 			{
 				for ( int i=0;i<MAXNORCOUNT;i++ )
 				{
 					switch ( i )
 					{
+						case 0:
+							if 	( m_gp->ProbeFun[m_gp->DebugChan] == 0 )
+								sprintf(m_Msg,"S%d OFF",m_gp->DebugChan+1);
+							else
+								m_lo->Probe_Fun_2_Char(m_gp->DebugChan+1,m_gp->ProbeFun[m_gp->DebugChan],m_gp->FreqIndex[m_gp->DebugChan]+1,m_Msg);
+							break;
+						case 1:
+							if 	( m_gp->ProbeFun[m_gp->DebugChan] == 0 )
+								sprintf(m_Msg,"OFF");
+							else
+								m_lo->Probe_Fun_2_Char_Only(m_gp->ProbeFun[m_gp->DebugChan],m_Msg);
+							break;
+						case 2:
+							if 	( m_gp->ProbeFun[m_gp->DebugChan] == 0 )
+								sprintf(m_Msg,"OFF");
+							else
+								sprintf(m_Msg,"F%d",m_gp->FreqIndex[m_gp->DebugChan]+1);
+							break;
+						case 3:
+							if 	( m_gp->ProbeFun[m_gp->DebugChan] == 0 )
+								sprintf(m_Msg,"OFF");
+							else
+								m_lo->Frequence_2_Char(m_gp->FreqValue[m_gp->FreqIndex[m_gp->DebugChan]],m_Msg);
+							break;
+						case 4:
+							if 	( m_gp->DFilter[m_gp->DebugChan] == 0 )
+								sprintf(m_Msg,"%s",m_pl->GetText(CLOSED));
+							else
+								sprintf(m_Msg,"%d",(1<<m_gp->DFilter[m_gp->DebugChan]));
+							break;
+						default:	
+							sprintf(m_Msg,"%s",m_pl->GetText(NONE));
+							break;
+					}				/* -----  end switch  ----- */
+					m_NorButton[i]->Set_Content(m_Msg);
+				}
+			}
+			break;
+		case 3:
+			{
+				for ( int i=0;i<MAXNORCOUNT;i++ )
+				{
+					switch ( i )
+					{
 						default:
 							sprintf(m_Msg,"%s",m_pl->GetText(NONE));
 							break;
@@ -1223,7 +1266,10 @@ void Mainwin::Refresh_Normal_Label_Content_2_ZKPanel(Graphic& g,int sub)
 							sprintf(m_Msg,"%d",m_gp->SingleCentY);
 							break;
 						case 2:
-							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->GainRatio)/10);
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->SingleGainRatio_X)/10);
+							break;
+						case 3:
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->SingleGainRatio_Y)/10);
 							break;
 						default:	
 							sprintf(m_Msg,"%s",m_pl->GetText(NONE));
@@ -1341,7 +1387,10 @@ void Mainwin::Refresh_Normal_Label_Content_2_DZKPanel(Graphic& g,int sub)
 							sprintf(m_Msg,"%d",m_gp->DoubleCentY2);
 							break;
 						case 4:
-							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->GainRatio)/10);
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->DoubleGainRatio_X)/10);
+							break;
+						case 5:
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->DoubleGainRatio_Y)/10);
 							break;
 						default:	
 							sprintf(m_Msg,"%s",m_pl->GetText(NONE));
@@ -1459,7 +1508,10 @@ void Mainwin::Refresh_Normal_Label_Content_2_CZKPanel(Graphic& g,int sub)
 							sprintf(m_Msg,"%d",m_gp->CompositeCentY2);
 							break;
 						case 4:
-							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->GainRatio)/10);
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->CompositeGainRatio_X)/10);
+							break;
+						case 5:
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->CompositeGainRatio_Y)/10);
 							break;
 						default:	
 							sprintf(m_Msg,"%s",m_pl->GetText(NONE));
@@ -1573,6 +1625,12 @@ void Mainwin::Refresh_Normal_Label_Content_2_OZKPanel(Graphic& g,int sub)
 							else if ( m_gp->CrossDisplayMode == 1 )
 								sprintf(m_Msg,"%s",m_pl->GetText(FUN_NORMAL));
 							break;
+						case 3:
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->CrossGainRatio_X)/10);
+							break;
+						case 4:
+							sprintf(m_Msg,"%.1f",static_cast<double>(m_gp->CrossGainRatio_Y)/10);
+							break;
 						default:	
 							sprintf(m_Msg,"%s",m_pl->GetText(NONE));
 							break;
@@ -2604,6 +2662,31 @@ const char*Mainwin::Get_Normal_Text_2_ColorPanel(int normal,int sub)
 				}				/* -----  end switch  ----- */
 			}
 			break;
+		case 2:
+			{
+				switch ( normal ) 
+				{
+					case 0: 
+						return m_pl->GetText(CHANNEL);
+						break;
+					case 1:	
+						return m_pl->GetText(PROBE);
+						break;
+					case 2:	
+						return m_pl->GetText(FREQUENCE);
+						break;
+					case 3: 
+						return m_pl->GetText(FREQUENCEVALUE);
+						break;
+					case 4:	
+						return m_pl->GetText(DIFILTER);
+						break;
+					default:	
+						return m_pl->GetText(NONE);
+						break;
+				}				/* -----  end switch  ----- */
+			}
+			break;
 		default:	
 			return m_pl->GetText(NONE);
 			break;
@@ -2679,7 +2762,10 @@ const char*Mainwin::Get_Normal_Text_2_ZKPanel(int normal,int sub)
 						return m_pl->GetText(Y1POINT);
 						break;
 					case 2:
-						return m_pl->GetText(GAINRATIO);
+						return m_pl->GetText(XGAINRATIO);
+						break;
+					case 3:
+						return m_pl->GetText(YGAINRATIO);
 						break;
 					default:	
 						return m_pl->GetText(NONE);
@@ -2771,7 +2857,10 @@ const char*Mainwin::Get_Normal_Text_2_DZKPanel(int normal,int sub)
 						return m_pl->GetText(Y2POINT);
 						break;
 					case 4:
-						return m_pl->GetText(GAINRATIO);
+						return m_pl->GetText(XGAINRATIO);
+						break;
+					case 5:
+						return m_pl->GetText(YGAINRATIO);
 						break;
 					default:	
 						return m_pl->GetText(NONE);
@@ -2858,6 +2947,12 @@ const char*Mainwin::Get_Normal_Text_2_OZKPanel(int normal,int sub)
 					case 2:
 						return m_pl->GetText(FUN_SELECT);
 						break;
+					case 3:
+						return m_pl->GetText(XGAINRATIO);
+						break;
+					case 4:
+						return m_pl->GetText(YGAINRATIO);
+						break;
 					default:	
 						return m_pl->GetText(NONE);
 						break;
@@ -2948,7 +3043,10 @@ const char*Mainwin::Get_Normal_Text_2_CZKPanel(int normal,int sub)
 						return m_pl->GetText(Y2POINT);
 						break;
 					case 4:
-						return m_pl->GetText(GAINRATIO);
+						return m_pl->GetText(XGAINRATIO);
+						break;
+					case 5:
+						return m_pl->GetText(YGAINRATIO);
 						break;
 					default:	
 						return m_pl->GetText(NONE);
diff --git a/src/EVA11/base/OZKPanel.cpp b/src/EVA11/base/OZKPanel.cpp
index ecb35c4..b2008a2 100644
--- a/src/EVA11/base/OZKPanel.cpp
+++ b/src/EVA11/base/OZKPanel.cpp
@@ -90,9 +90,12 @@ void OZKPanel::Init_GUI(Graphic& g)
 	for ( int i=0;i<m_cMAXScreenCount;i++ )
 		m_LimitManage[i]->Init_Alarm_Sets(g);
 
-	for (int i=0;i<8;i++ )
+	for (int i=0;i<m_cMAXScreenCount;i++ )
 		m_Zscreen[i]->Set_Center_Point(m_gp->OCTCentX[i],m_gp->OCTCentY[i]);
 
+	for (int i=0;i<m_cMAXScreenCount;i++ )
+		m_Zscreen[i]->Set_Ratio_Gain_Type(Zscreen::CROSS);
+
 	for ( int i=0;i<m_cMAXScreenCount;i++ )
 	{
 		m_Zscreen[i]->Set_Color(Zscreen::LA_FG_COLOR,g_BUTXNO_CO);
diff --git a/src/EVA11/base/OZKPanel.h b/src/EVA11/base/OZKPanel.h
index d03ed9d..c63e375 100644
--- a/src/EVA11/base/OZKPanel.h
+++ b/src/EVA11/base/OZKPanel.h
@@ -72,7 +72,8 @@ class OZKPanel : public BasePanel
 		void Refresh_Calculate_Value(Graphic& g,int index,double value);
 
 	private:
-		const static int			m_cMAXScreenCount = 8;
+		enum 					{ m_cMAXScreenCount = 8 };
+
 		Zscreen*				m_Zscreen[m_cMAXScreenCount];
 
 		Label*					m_labMsg[m_cMAXScreenCount];
diff --git a/src/EVA11/base/Process.cpp b/src/EVA11/base/Process.cpp
index 092dab4..555cbee 100644
--- a/src/EVA11/base/Process.cpp
+++ b/src/EVA11/base/Process.cpp
@@ -1007,7 +1007,7 @@ void ParameterProcess::Do_Event_ColorPanel(Graphic& g,int sub,int nor,RLKEY key)
 						}
 					}
 					break;
-				case 2: 
+				case 2:
 					{
 						if 	( m_gp->ColorSpotSampleType == 0 )
 						{
@@ -1045,7 +1045,7 @@ void ParameterProcess::Do_Event_ColorPanel(Graphic& g,int sub,int nor,RLKEY key)
 						}
 					}
 					break;
-				case 3: 
+				case 3:
 					{
 						if 	( key == LKEY )
 						{
@@ -1079,7 +1079,7 @@ void ParameterProcess::Do_Event_ColorPanel(Graphic& g,int sub,int nor,RLKEY key)
 						}
 					}
 					break;
-				case 5: 
+				case 5:
 					{
 						if 	( key == LKEY )
 						{
@@ -1091,7 +1091,7 @@ void ParameterProcess::Do_Event_ColorPanel(Graphic& g,int sub,int nor,RLKEY key)
 						}
 					}
 					break;
-				case 6: 
+				case 6:
 					{
 						if 	( key == LKEY )
 						{
@@ -1111,6 +1111,135 @@ void ParameterProcess::Do_Event_ColorPanel(Graphic& g,int sub,int nor,RLKEY key)
 					break;
 			}
 			break;
+		case 2:
+			{
+				switch ( nor )
+				{
+					case 1:
+						{
+							if 	( key == LKEY )
+							{
+								if ( m_gp->DebugChan == 0 ) m_gp->DebugChan = Global::CHANCOUNT-1;
+								else m_gp->DebugChan --;
+							}
+							else if ( key == RKEY )
+							{
+								if ( m_gp->DebugChan == Global::CHANCOUNT-1 ) m_gp->DebugChan = 0;
+								else m_gp->DebugChan ++;
+							}
+						}
+						break;
+					case 2: 
+						{
+							if 	( key == LKEY )
+							{
+								if 	( m_gp->ProbeFun[m_gp->DebugChan] == 0 )
+									m_gp->ProbeFun[m_gp->DebugChan] = 3;
+								else
+									m_gp->ProbeFun[m_gp->DebugChan] --;
+
+								m_device->Set_Para_SignalID(m_gp->DebugChan,
+											    m_gp->ProbeFun[m_gp->DebugChan],
+											    m_gp->FreqIndex[m_gp->DebugChan]+1);
+							}
+							else if ( key == RKEY )
+							{
+								if 	( m_gp->ProbeFun[m_gp->DebugChan] == 3)
+									m_gp->ProbeFun[m_gp->DebugChan] = 0; 
+								else
+									m_gp->ProbeFun[m_gp->DebugChan] ++;
+
+								m_device->Set_Para_SignalID(m_gp->DebugChan,
+											    m_gp->ProbeFun[m_gp->DebugChan],
+											    m_gp->FreqIndex[m_gp->DebugChan]+1);
+							}
+						}
+						break;
+					case 3: 
+						{
+							if 	( key == LKEY )
+							{
+								if 	( m_gp->FreqIndex[m_gp->DebugChan] == 0 )
+									m_gp->FreqIndex[m_gp->DebugChan] = Global::FREQCOUNT-1;
+								else
+									m_gp->FreqIndex[m_gp->DebugChan] --;
+
+								m_device->Set_Para_SignalID(m_gp->DebugChan,
+											    m_gp->ProbeFun[m_gp->DebugChan],
+											    m_gp->FreqIndex[m_gp->DebugChan]+1);
+							}
+							else if ( key == RKEY )
+							{
+								if 	( m_gp->FreqIndex[m_gp->DebugChan] == Global::FREQCOUNT-1 )
+									m_gp->FreqIndex[m_gp->DebugChan] = 0;
+								else
+									m_gp->FreqIndex[m_gp->DebugChan] ++;
+
+								m_device->Set_Para_SignalID(m_gp->DebugChan,
+											    m_gp->ProbeFun[m_gp->DebugChan],
+											    m_gp->FreqIndex[m_gp->DebugChan]+1);
+							}
+						}
+						break;
+					case 4:
+						{
+							if 	( key == LKEY )
+							{
+								int freqindex = m_device->Get_Frequence_Index(m_gp->FreqValue[m_gp->FreqIndex[m_gp->DebugChan]]);
+								freqindex     = m_device->Calculate_New_Frequence(false,freqindex,1);
+								int newfreqvalue = m_device->Get_Frequence(freqindex);
+								m_gp->FreqValue[m_gp->FreqIndex[m_gp->DebugChan]] = newfreqvalue;
+								m_device->Set_Para_Frequence_Value(m_gp->DebugChan,newfreqvalue);
+							}
+							else if ( key == RKEY )
+							{
+								int freqindex = m_device->Get_Frequence_Index(m_gp->FreqValue[m_gp->FreqIndex[m_gp->DebugChan]]);
+								freqindex     = m_device->Calculate_New_Frequence(true,freqindex,1);
+								int newfreqvalue = m_device->Get_Frequence(freqindex);
+								m_gp->FreqValue[m_gp->FreqIndex[m_gp->DebugChan]] = newfreqvalue;
+								m_device->Set_Para_Frequence_Value(m_gp->DebugChan,newfreqvalue);
+							}
+						}
+						break;
+					case 5: 
+						{
+							if 	( key == LKEY )
+							{
+								if 	( m_gp->DFilter[m_gp->DebugChan] == 0 )
+									m_gp->DFilter[m_gp->DebugChan] = 7;
+								else
+									m_gp->DFilter[m_gp->DebugChan] --;
+								
+								Algorithm* alg = Algorithm::Instance();
+								alg->Reset_MAX_Value(m_gp->DebugChan,m_gp->DFilter[m_gp->DebugChan]);
+							}
+							else if ( key == RKEY )
+							{
+								if 	( m_gp->DFilter[m_gp->DebugChan] == 7 )
+									m_gp->DFilter[m_gp->DebugChan] = 0;
+								else
+									m_gp->DFilter[m_gp->DebugChan] ++;
+
+								Algorithm* alg = Algorithm::Instance();
+								alg->Reset_MAX_Value(m_gp->DebugChan,m_gp->DFilter[m_gp->DebugChan]);
+							}
+						}
+						break;
+					case 6: 
+						{
+							if 	( key == LKEY )
+							{
+
+							}
+							else if ( key == RKEY )
+							{
+
+							}
+						}
+						break;
+				}
+			}
+			break;
 	}
 
 }
@@ -1474,20 +1603,42 @@ void ParameterProcess::Do_Event_ZKPanel(Graphic& g,int sub,int nor,RLKEY key)
 						if 	( key == LKEY )
 						{
 							Algorithm* m_alg = Algorithm::Instance();
-							if ( m_gp->GainRatio == 1 )
-								m_gp->GainRatio = 100;
+							if ( m_gp->SingleGainRatio_X == 1 )
+								m_gp->SingleGainRatio_X = 100;
+							else
+								m_gp->SingleGainRatio_X--;
+							m_alg->Calculate_All_Gain_Ratio();
+						}
+						else if ( key == RKEY )
+						{
+							Algorithm* m_alg = Algorithm::Instance();
+							if ( m_gp->SingleGainRatio_X == 100 )
+								m_gp->SingleGainRatio_X = 1;
+							else
+								m_gp->SingleGainRatio_X ++;
+							m_alg->Calculate_All_Gain_Ratio();
+						}
+					}
+					break;
+				case 4:
+					{
+						if 	( key == LKEY )
+						{
+							Algorithm* m_alg = Algorithm::Instance();
+							if ( m_gp->SingleGainRatio_Y == 1 )
+								m_gp->SingleGainRatio_Y = 100;
 							else
-								m_gp->GainRatio--;
-							m_alg->Calculate_Gain_Ratio(m_gp->GainRatio);
+								m_gp->SingleGainRatio_Y--;
+							m_alg->Calculate_All_Gain_Ratio();
 						}
 						else if ( key == RKEY )
 						{
 							Algorithm* m_alg = Algorithm::Instance();
-							if ( m_gp->GainRatio == 100 )
-								m_gp->GainRatio = 1;
+							if ( m_gp->SingleGainRatio_Y == 100 )
+								m_gp->SingleGainRatio_Y = 1;
 							else
-								m_gp->GainRatio ++;
-							m_alg->Calculate_Gain_Ratio(m_gp->GainRatio);
+								m_gp->SingleGainRatio_Y ++;
+							m_alg->Calculate_All_Gain_Ratio();
 						}
 					}
 					break;
@@ -1800,19 +1951,40 @@ void ParameterProcess::Do_Event_DZKPanel(Graphic& g,int sub,int nor,RLKEY key)
 							Algorithm* m_alg = Algorithm::Instance();
 							if 	( key == LKEY )
 							{
-								if ( m_gp->GainRatio == 1 )
-									m_gp->GainRatio = 100;
+								if ( m_gp->DoubleGainRatio_X == 1 )
+									m_gp->DoubleGainRatio_X = 100;
+								else
+									m_gp->DoubleGainRatio_X--;
+								m_alg->Calculate_All_Gain_Ratio();
+							}
+							else if ( key == RKEY )
+							{
+								if ( m_gp->DoubleGainRatio_X == 100 )
+									m_gp->DoubleGainRatio_X = 1;
+								else
+									m_gp->DoubleGainRatio_X ++;
+								m_alg->Calculate_All_Gain_Ratio();
+							}
+						}
+						break;
+					case 6: 
+						{
+							Algorithm* m_alg = Algorithm::Instance();
+							if 	( key == LKEY )
+							{
+								if ( m_gp->DoubleGainRatio_Y == 1 )
+									m_gp->DoubleGainRatio_Y = 100;
 								else
-									m_gp->GainRatio--;
-								m_alg->Calculate_Gain_Ratio(m_gp->GainRatio);
+									m_gp->DoubleGainRatio_Y--;
+								m_alg->Calculate_All_Gain_Ratio();
 							}
 							else if ( key == RKEY )
 							{
-								if ( m_gp->GainRatio == 100 )
-									m_gp->GainRatio = 1;
+								if ( m_gp->DoubleGainRatio_Y == 100 )
+									m_gp->DoubleGainRatio_Y = 1;
 								else
-									m_gp->GainRatio ++;
-								m_alg->Calculate_Gain_Ratio(m_gp->GainRatio);
+									m_gp->DoubleGainRatio_Y ++;
+								m_alg->Calculate_All_Gain_Ratio();
 							}
 						}
 						break;
@@ -2205,20 +2377,42 @@ void ParameterProcess::Do_Event_CZKPanel(Graphic& g,int sub,int nor,RLKEY key)
 							if 	( key == LKEY )
 							{
 								Algorithm* m_alg = Algorithm::Instance();
-								if ( m_gp->GainRatio == 1 )
-									m_gp->GainRatio = 100;
+								if ( m_gp->CompositeGainRatio_X == 1 )
+									m_gp->CompositeGainRatio_X = 100;
 								else
-									m_gp->GainRatio--;
-								m_alg->Calculate_Gain_Ratio(m_gp->GainRatio);
+									m_gp->CompositeGainRatio_X--;
+								m_alg->Calculate_All_Gain_Ratio();
 							}
 							else if ( key == RKEY )
 							{
 								Algorithm* m_alg = Algorithm::Instance();
-								if ( m_gp->GainRatio == 100 )
-									m_gp->GainRatio = 1;
+								if ( m_gp->CompositeGainRatio_X == 100 )
+									m_gp->CompositeGainRatio_X = 1;
 								else
-									m_gp->GainRatio ++;
-								m_alg->Calculate_Gain_Ratio(m_gp->GainRatio);
+									m_gp->CompositeGainRatio_X ++;
+								m_alg->Calculate_All_Gain_Ratio();
+							}
+						}
+						break;
+					case 6: 
+						{
+							if 	( key == LKEY )
+							{
+								Algorithm* m_alg = Algorithm::Instance();
+								if ( m_gp->CompositeGainRatio_Y == 1 )
+									m_gp->CompositeGainRatio_Y = 100;
+								else
+									m_gp->CompositeGainRatio_Y--;
+								m_alg->Calculate_All_Gain_Ratio();
+							}
+							else if ( key == RKEY )
+							{
+								Algorithm* m_alg = Algorithm::Instance();
+								if ( m_gp->CompositeGainRatio_Y == 100 )
+									m_gp->CompositeGainRatio_Y = 1;
+								else
+									m_gp->CompositeGainRatio_Y ++;
+								m_alg->Calculate_All_Gain_Ratio();
 							}
 						}
 						break;
@@ -2597,6 +2791,50 @@ void ParameterProcess::Do_Event_OZKPanel(Graphic& g,int sub,int nor,RLKEY key)
 					}
 					break;
 
+				case 4:
+					{
+						Algorithm* m_alg = Algorithm::Instance();
+						if 	( key == LKEY )
+						{
+							if ( m_gp->CrossGainRatio_X == 1 )
+								m_gp->CrossGainRatio_X = 100;
+							else
+								m_gp->CrossGainRatio_X--;
+							m_alg->Calculate_All_Gain_Ratio();
+						}
+						else if ( key == RKEY )
+						{
+							if ( m_gp->CrossGainRatio_X == 100 )
+								m_gp->CrossGainRatio_X = 1;
+							else
+								m_gp->CrossGainRatio_X ++;
+							m_alg->Calculate_All_Gain_Ratio();
+						}
+					}
+					break;
+
+				case 5:
+					{
+						Algorithm* m_alg = Algorithm::Instance();
+						if 	( key == LKEY )
+						{
+							if ( m_gp->CrossGainRatio_Y == 1 )
+								m_gp->CrossGainRatio_Y = 100;
+							else
+								m_gp->CrossGainRatio_Y--;
+							m_alg->Calculate_All_Gain_Ratio();
+						}
+						else if ( key == RKEY )
+						{
+							if ( m_gp->CrossGainRatio_Y == 100 )
+								m_gp->CrossGainRatio_Y = 1;
+							else
+								m_gp->CrossGainRatio_Y ++;
+							m_alg->Calculate_All_Gain_Ratio();
+						}
+					}
+					break;
+
 				default:	
 					break;
 			}				/* -----  end switch  ----- */
diff --git a/src/EVA11/base/Sinscreen.cpp b/src/EVA11/base/Sinscreen.cpp
index 71bac34..9fe4de1 100644
--- a/src/EVA11/base/Sinscreen.cpp
+++ b/src/EVA11/base/Sinscreen.cpp
@@ -24,6 +24,10 @@
 
 #include 	"Filte.h"
 
+#include 	"FreeType.h"
+#include 	"Logic.h"
+#include 	"Global.h"
+
 Sinscreen::Sinscreen (int x,int y,int width,int heigh)
 	: Basescreen(x,y,width,heigh)
 	, m_BackCoordinate(GRID)
@@ -51,7 +55,11 @@ void Sinscreen::Refreshme(Graphic& g)
 	g.Setcolor(m_FGColor);
 	g.DrawFillRect(m_X,m_Y,m_Width,m_Heigh,m_BGColor);	
 	if ( m_BackCoordinate == GRID )
+	{
 		DrawGrid(g);
+		Display_Probe_Information(g);
+	}
+
 	if ( m_Focus == true ) g.Setcolor(m_FocusColor);
 	g.DrawRect(m_X,m_Y,m_Width,m_Heigh);	
 	g.DrawRect(m_X+1,m_Y+1,m_Width-2,m_Heigh-2);	
@@ -107,3 +115,75 @@ void Sinscreen::Set_Back_Coordinate(BACKCOOR back)
 {
 	m_BackCoordinate = back;
 }
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Display_Probe_Information
+ *  Description:  Show the Probe information on screen such Channel C1 C2 HDGain ... 
+ * =====================================================================================
+ */
+void Sinscreen::Display_Probe_Information(Graphic& g)
+{
+	FreeType *m_ft 	=  FreeType::Instance();
+	Global *m_gp    = Global::Instance();	
+	Logic *m_lo     = Logic::Instance();
+
+
+	int fs = m_ft->Get_Font_Size();
+	m_ft->Set_Font_Size(15);
+
+	if 	( m_gp->ProbeFun[m_gp->DebugChan] == 0 )
+		sprintf(m_Msg,"S%d OFF",m_gp->DebugChan+1);
+	else
+		m_lo->Probe_Fun_2_Char(m_gp->DebugChan+1,m_gp->ProbeFun[m_gp->DebugChan],m_gp->FreqIndex[m_gp->DebugChan]+1,m_Msg);
+
+	m_ft->Text(m_X+10,m_Y+20,m_Msg);
+	sprintf(m_Msg,"%d dB",m_gp->HDGain[m_gp->DebugChan]*5);
+	m_ft->Text(m_X+10,m_Y+40,m_Msg);
+	m_lo->Frequence_2_Char(m_gp->FreqValue[m_gp->FreqIndex[m_gp->DebugChan]],m_Msg);
+	m_ft->Text(m_X+10,m_Y+60,m_Msg);
+
+	if 	( m_gp->Driver == 4 )
+		sprintf(m_Msg,"%d V(*)",5);
+	else
+		sprintf(m_Msg,"%d V",m_gp->Driver+1);
+	m_ft->Text(m_X+10,m_Y+80,m_Msg);
+
+	sprintf(m_Msg,"%d",m_gp->DriverBal[m_gp->DebugChan]-8);
+	m_ft->Text(m_X+10,m_Y+m_Heigh-100,m_Msg);
+
+	if ( m_gp->DriverA_ID[m_gp->DebugChan] >= 0 && m_gp->DriverA_ID[m_gp->DebugChan] <= 247 )
+		sprintf(m_Msg,"C%d",m_gp->DriverA_ID[m_gp->DebugChan]+1);
+	else if ( m_gp->DriverA_ID[m_gp->DebugChan] == 254 )
+		sprintf(m_Msg,"%s","GND");
+	else if ( m_gp->DriverA_ID[m_gp->DebugChan] == 255 )
+		sprintf(m_Msg,"%s","NULL");
+	m_ft->Text(m_X+10,m_Y+m_Heigh-80,m_Msg);
+
+	if ( m_gp->DriverB_ID[m_gp->DebugChan] >= 0 && m_gp->DriverB_ID[m_gp->DebugChan] <= 247 )
+		sprintf(m_Msg,"C%d",m_gp->DriverB_ID[m_gp->DebugChan]+1);
+	else if ( m_gp->DriverB_ID[m_gp->DebugChan] == 254 )
+		sprintf(m_Msg,"%s","GND");
+	else if ( m_gp->DriverB_ID[m_gp->DebugChan] == 255 )
+		sprintf(m_Msg,"%s","NULL");
+	m_ft->Text(m_X+10,m_Y+m_Heigh-60,m_Msg);
+
+	if ( m_gp->PickA_ID[m_gp->DebugChan] >= 0 && m_gp->PickA_ID[m_gp->DebugChan] <= 247 )
+		sprintf(m_Msg,"C%d",m_gp->PickA_ID[m_gp->DebugChan]+1);
+	else if ( m_gp->PickA_ID[m_gp->DebugChan] == 254 )
+		sprintf(m_Msg,"%s","GND");
+	else if ( m_gp->PickA_ID[m_gp->DebugChan] == 255 )
+		sprintf(m_Msg,"%s","NULL");
+	m_ft->Text(m_X+10,m_Y+m_Heigh-40,m_Msg);
+
+	if ( m_gp->PickB_ID[m_gp->DebugChan] >= 0 && m_gp->PickB_ID[m_gp->DebugChan] <= 247 )
+		sprintf(m_Msg,"C%d",m_gp->PickB_ID[m_gp->DebugChan]+1);
+	else if ( m_gp->PickB_ID[m_gp->DebugChan] == 254 )
+		sprintf(m_Msg,"%s","GND");
+	else if ( m_gp->PickB_ID[m_gp->DebugChan] == 255 )
+		sprintf(m_Msg,"%s","NULL");
+	m_ft->Text(m_X+10,m_Y+m_Heigh-20,m_Msg);
+	m_ft->Text(m_X+10,m_Y+m_Heigh-20,m_Msg);
+
+	m_ft->Set_Font_Size(fs);
+}
diff --git a/src/EVA11/base/Sinscreen.h b/src/EVA11/base/Sinscreen.h
index 4b199c5..237939d 100644
--- a/src/EVA11/base/Sinscreen.h
+++ b/src/EVA11/base/Sinscreen.h
@@ -41,6 +41,8 @@ class Sinscreen : public Basescreen
 	protected:
 		virtual void Refreshme(Graphic& g);
 	private:
+		void Display_Probe_Information(Graphic& g);
+	private:
 		BACKCOOR		m_BackCoordinate;
 		Filte*			m_Filter;
 };
diff --git a/src/EVA11/base/ZKPanel.cpp b/src/EVA11/base/ZKPanel.cpp
index b79b8cf..db3edbc 100644
--- a/src/EVA11/base/ZKPanel.cpp
+++ b/src/EVA11/base/ZKPanel.cpp
@@ -99,6 +99,7 @@ void ZKPanel::Init_GUI(Graphic& g)
 	Global *gp = Global::Instance();
 
 	m_Zscreen = new(std::nothrow) Zscreen(2+130,13+31,400,399);
+	m_Zscreen->Set_Ratio_Gain_Type(Zscreen::SINGLE);
 	m_Zscreen->Set_Center_Point(m_gp->SingleCentX,m_gp->SingleCentY);
 
 	m_Zscreen->Set_Color(Zscreen::LA_FG_COLOR,g_BUTXNO_CO);
diff --git a/src/EVA11/base/ZScreen.cpp b/src/EVA11/base/ZScreen.cpp
index 6bf85f6..ce064a0 100644
--- a/src/EVA11/base/ZScreen.cpp
+++ b/src/EVA11/base/ZScreen.cpp
@@ -36,9 +36,10 @@
 #include 	"Msgbox.h"
 #include 	"CalculateCenter.h"
 
+
 Zscreen::Zscreen (int x,int y,int width,int heigh)
 	: Basescreen(x,y,width,heigh)
-	, m_BackCoordinate(GRID) , m_DrawMode(LINE) , m_ID(1)
+	, m_BackCoordinate(GRID) , m_DrawMode(LINE) , m_ID(1) , m_Gain_Ratio_Type(OTHER)
 {
 	m_Trace                 = NULL;
 	int leng                = (m_Width-2)*(m_Heigh-2);
@@ -55,7 +56,7 @@ Zscreen::Zscreen (int x,int y,int width,int heigh)
 	char temp[5];
 	sprintf(temp,"%d",m_ID);
 
-	m_Focus = false;
+	m_Focus 		= false;
 
 	m_labID			= new Label(m_X+m_Width-19,m_Y+m_Heigh-23,16,20);
 	m_labID->Set_Text(temp);
@@ -66,9 +67,9 @@ Zscreen::Zscreen (int x,int y,int width,int heigh)
 	{
 		m_labID->Set_Label_Color(Label::LA_BGNO_COLOR,g_BUBGNO_CO);
 		m_labID->Set_Label_Color(Label::LA_FGNO_COLOR,g_BUTXNO_CO);
-	}                                     
-	else                                  
-	{                                     
+	}
+	else
+	{
 		m_labID->Set_Label_Color(Label::LA_BGNO_COLOR,g_BUBGFO_CO);
 		m_labID->Set_Label_Color(Label::LA_FGNO_COLOR,g_BUTXFO_CO);
 	}
@@ -639,23 +640,29 @@ void Zscreen::Set_Gain_Degree_ReDraw(Graphic& g,int channel,int loopstart,int lo
 			mixm->Mixing(0,rawdata[0],rawdata[1],rawdata[2],rawdata[3]);
 			X_temp = rawdata[2]   * gp->SoftMixGain[channel-2];
 			Y_temp = 0 - rawdata[3] * gp->SoftMixGain[channel-2];
-			Y_temp = m_alg->Gain_Ratio(Y_temp);
+
+			X_temp = Calculate_Gain_Ratio_X(X_temp);
+			Y_temp = Calculate_Gain_Ratio_Y(Y_temp);
+
 			m_alg->Rotation(gp->MixDegree[channel-2],X_temp,Y_temp,X_,Y_);
 			Y_ = 0 - Y_;
 			Draw_ET_Point(g,X_,Y_);
-			cc->Calculate_Graphic_MAX_MIN_Value(rawdata[2],
-							   m_alg->Gain_Ratio(static_cast<double>(rawdata[3])));
+			cc->Calculate_Graphic_MAX_MIN_Value(Calculate_Gain_Ratio_X(static_cast<double>(rawdata[2])),
+							   Calculate_Gain_Ratio_Y(static_cast<double>(rawdata[3])));
 		}
 		else
 		{
 			X_temp = rawdata[(channel<<1)]   * gp->SoftGain[channel];
 			Y_temp = 0 - rawdata[(channel<<1)+1] * gp->SoftGain[channel];
-			Y_temp = m_alg->Gain_Ratio(Y_temp);
+
+			X_temp = Calculate_Gain_Ratio_X(X_temp);
+			Y_temp = Calculate_Gain_Ratio_Y(Y_temp);
+
 			m_alg->Rotation(gp->Degree[channel],X_temp,Y_temp,X_,Y_);
 			Y_ = 0 - Y_;
 			Draw_ET_Point(g,X_,Y_);
-			cc->Calculate_Graphic_MAX_MIN_Value(rawdata[(channel<<1)],
-							   m_alg->Gain_Ratio(static_cast<double>(rawdata[(channel<<1)+1])));
+			cc->Calculate_Graphic_MAX_MIN_Value(Calculate_Gain_Ratio_X(static_cast<double>(rawdata[(channel<<1)])),
+							    Calculate_Gain_Ratio_Y(static_cast<double>(rawdata[(channel<<1)+1])));
 		}
 	}
 
@@ -668,7 +675,9 @@ void Zscreen::Set_Gain_Degree_ReDraw(Graphic& g,int channel,int loopstart,int lo
 		{
 			repo->Get_One_Loop_Back(rawdata,loop);
 			mixm->Mixing(0,rawdata[0],rawdata[1],rawdata[2],rawdata[3]);
-			cc->Record_MAXValue(rawdata[2],m_alg->Gain_Ratio(static_cast<double>(rawdata[3])));
+
+			cc->Record_MAXValue(Calculate_Gain_Ratio_X(static_cast<double>(rawdata[2])),
+					    Calculate_Gain_Ratio_Y(static_cast<double>(rawdata[3])));
 		}
 	}
 	else
@@ -676,7 +685,10 @@ void Zscreen::Set_Gain_Degree_ReDraw(Graphic& g,int channel,int loopstart,int lo
 		for ( int loop=loopstart;loop!=loopend;loop-- )
 		{
 			repo->Get_One_Loop_Back(rawdata,loop);
-			cc->Record_MAXValue(rawdata[(channel<<1)],m_alg->Gain_Ratio(static_cast<double>(rawdata[(channel<<1)+1])));
+
+
+			cc->Record_MAXValue(Calculate_Gain_Ratio_X(static_cast<double>(rawdata[(channel<<1)])),
+					    Calculate_Gain_Ratio_Y(static_cast<double>(rawdata[(channel<<1)+1])));
 		}
 	}
 
@@ -999,3 +1011,76 @@ void Zscreen::Clean_Photo()
 {
 	memset(m_Photo,0,(m_Width-2)*(m_Heigh-2));
 }
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Set_Ratio_Gain_Type
+ *  Description:  Set the Ratio Gain Type 
+ * =====================================================================================
+ */
+void Zscreen::Set_Ratio_Gain_Type(GAINRATIOTYPE type)
+{
+	m_Gain_Ratio_Type = type;
+}
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Calculate_Gain_Ratio_X
+ *  Description:  
+ * =====================================================================================
+ */
+double Zscreen::Calculate_Gain_Ratio_X(double x)
+{
+	switch ( m_Gain_Ratio_Type ) {
+		case SINGLE:	
+			return m_alg->Single_Gain_Ratio_X(x);
+			break;
+
+		case DOUBLE:	
+			return m_alg->Double_Gain_Ratio_X(x);
+			break;
+
+		case CROSS:	
+			return m_alg->Cross_Gain_Ratio_X(x);
+			break;
+
+		case COMPISITE:	
+			return m_alg->Composite_Gain_Ratio_X(x);
+			break;
+
+		default:	
+			return m_alg->Gain_Ratio(x);
+			break;
+	}				/* -----  end switch  ----- */
+}
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Calculate_Gain_Ratio_Y
+ *  Description:  
+ * =====================================================================================
+ */
+double Zscreen::Calculate_Gain_Ratio_Y(double y)
+{
+	switch ( m_Gain_Ratio_Type ) {
+		case SINGLE:
+			return m_alg->Single_Gain_Ratio_Y(y);
+			break;
+
+		case DOUBLE:
+			return m_alg->Double_Gain_Ratio_Y(y);
+			break;
+
+		case CROSS:
+			return m_alg->Cross_Gain_Ratio_Y(y);
+			break;
+
+		case COMPISITE:
+			return m_alg->Composite_Gain_Ratio_Y(y);
+			break;
+
+		default:
+			return m_alg->Gain_Ratio(y);
+			break;
+	}				/* -----  end switch  ----- */
+}
diff --git a/src/EVA11/base/ZScreen.h b/src/EVA11/base/ZScreen.h
index ab4d8e3..00fd7d1 100644
--- a/src/EVA11/base/ZScreen.h
+++ b/src/EVA11/base/ZScreen.h
@@ -54,6 +54,16 @@ class Zscreen : public Basescreen
 
 		typedef enum DIRECT DIRECT;
 
+		enum GAINRATIOTYPE {
+			SINGLE    = 0,
+			DOUBLE    = 1,
+			CROSS  	  = 2,
+			COMPISITE = 3,
+			OTHER     = 99
+		};				/* ----------  end of enum GAINRATIOTYPE  ---------- */
+
+		typedef enum GAINRATIOTYPE GAINRATIOTYPE;
+
 		Zscreen (int x,int y,int width,int heigh);
 		~Zscreen ();
 		void Set_Back_Coordinate(BACKCOOR);
@@ -83,6 +93,8 @@ class Zscreen : public Basescreen
 		void Save_Photo(Graphic& g);
 		void Clean_Photo();
 
+		void Set_Ratio_Gain_Type(GAINRATIOTYPE);
+
 	protected:
 		virtual void Refreshme(Graphic& g);
 	private:
@@ -110,6 +122,9 @@ class Zscreen : public Basescreen
 		void WholeCircle(Graphic &g,int xc,int yc,int x,int y,int color);
 		void BresenhamCircle(Graphic &g,int xc,int yc,int radius,int color);
 		void Draw_Photo(Graphic& g);
+
+		double Calculate_Gain_Ratio_X(double);
+		double Calculate_Gain_Ratio_Y(double);
 	private:
 		struct DATABALL 
 		{
@@ -157,5 +172,7 @@ class Zscreen : public Basescreen
 		bool 				m_LastAlarmStatus;
 		double 				m_LastResult;              /* Record Last Detect value */
 		int 				m_Decay;
+
+		GAINRATIOTYPE			m_Gain_Ratio_Type;
 };
 #endif
diff --git a/src/EVA11/base/main.h b/src/EVA11/base/main.h
index 085fbaf..0776f09 100644
--- a/src/EVA11/base/main.h
+++ b/src/EVA11/base/main.h
@@ -19,7 +19,7 @@
 #define _MAINHEAD_
 
 #define PROVERSION 	"1.02"
-#define PAR_FILE_PATH	"/var/1"
+#define PAR_FILE_PATH	"/tmp/smart2005a.par"
 
 #ifdef ARM9
 #define FONT_FILE_PATH  "/tmp/wqy-zenhei.ttc"
-- 
1.8.5.1

