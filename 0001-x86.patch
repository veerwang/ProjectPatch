From 0fc925872e03c43aaf5478df8a1878b36e6415c6 Mon Sep 17 00:00:00 2001
From: kevin <kevin.wang2004@hotmail.com>
Date: Mon, 6 Jan 2014 08:37:13 +0800
Subject: [PATCH] =?UTF-8?q?=E7=BB=A7=E7=BB=AD=E4=BF=AE=E6=94=B9=E7=A8=8B?=
 =?UTF-8?q?=E5=BA=8F=E4=BB=A3=E7=A0=81=E4=BD=BF=E4=B9=8B=EF=BC=8C=E8=83=BD?=
 =?UTF-8?q?=E5=A4=9F=E5=9C=A8x86=E5=B9=B3=E5=8F=B0=E4=B8=8B=E5=8F=AF?=
 =?UTF-8?q?=E4=BB=A5=E8=BF=90=E8=A1=8C?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 src/EVA11/DZKPanel.cpp    | 4 ++--
 src/EVA11/DetectView.cpp  | 6 ++++++
 src/EVA11/Mainwin.cpp     | 3 +++
 src/EVA11/ProjectGBText.h | 9 +++++++++
 src/EVA11/main.cpp        | 4 ++--
 5 files changed, 22 insertions(+), 4 deletions(-)

diff --git a/src/EVA11/DZKPanel.cpp b/src/EVA11/DZKPanel.cpp
index 47e8100..9119f52 100644
--- a/src/EVA11/DZKPanel.cpp
+++ b/src/EVA11/DZKPanel.cpp
@@ -47,7 +47,7 @@
 
 #include 	"Resource.h"
 
-const static  char* AlarmText[8] = {"A","B","C","D","E","F","G","H"};
+const static  std::string AlarmText[8] = {CSTRING_A,CSTRING_B,CSTRING_C,CSTRING_D,CSTRING_E,CSTRING_F,CSTRING_G,CSTRING_H};
 
 DZKPanel::DZKPanel (int x,int y,int width,int heigh)
 	: BasePanel(x,y,width,heigh)
@@ -379,7 +379,7 @@ int DZKPanel::Loop_Panel(Graphic& g)
 		{
 			if 	( result != m_LastStatus[i] )
 			{
-				m_LabAlarmSt[i]->Set_Text(AlarmText[result]);
+				m_LabAlarmSt[i]->Set_Text(AlarmText[result].c_str());
 				m_LabAlarmSt[i]->Drawme(g);
 				m_LastStatus[i] = result;
 			}
diff --git a/src/EVA11/DetectView.cpp b/src/EVA11/DetectView.cpp
index 232f535..84f7ec2 100644
--- a/src/EVA11/DetectView.cpp
+++ b/src/EVA11/DetectView.cpp
@@ -271,6 +271,9 @@ void DetectView::Lock_View(Graphic& g)
 			g.Setpixel(m_X+m_Width-i-1,j,g.RGB24_16(alg->Alpha_Color(239,60,25,80,g.Getpixel(m_X+m_Width-i-1,j))));
 		}
 	}
+#ifdef X86
+	g.Update_Rect(0,0,640,480);
+#endif
 }
 
 /* 
@@ -282,6 +285,9 @@ void DetectView::Lock_View(Graphic& g)
 void DetectView::UnLock_View(Graphic& g)
 {
 	g.Restore_Disp_Area(m_X,m_Y,m_X+m_Width-1,m_Y+m_Heigh-1,m_ViewDisBuffer);
+#ifdef X86
+	g.Update_Rect(0,0,640,480);
+#endif
 }
 
 /* 
diff --git a/src/EVA11/Mainwin.cpp b/src/EVA11/Mainwin.cpp
index 7219343..38fd99a 100644
--- a/src/EVA11/Mainwin.cpp
+++ b/src/EVA11/Mainwin.cpp
@@ -67,6 +67,9 @@ void Mainwin::Drawme(Graphic &g)
 	Refresh_Small_Label(g);
 	Refresh_Normal_Label_Content(g);
 	Refresh_Normal_Label_Text(g);
+#ifdef X86
+	g.Update_Rect(0,0,640,480);
+#endif
 }
 
 /* 
diff --git a/src/EVA11/ProjectGBText.h b/src/EVA11/ProjectGBText.h
index 9ca1fb5..ffeed38 100644
--- a/src/EVA11/ProjectGBText.h
+++ b/src/EVA11/ProjectGBText.h
@@ -755,6 +755,15 @@
 
 #define	NONE			    999
 
+#define CSTRING_A		    "A"
+#define CSTRING_B		    "B"
+#define CSTRING_C		    "C"
+#define CSTRING_D		    "D"
+#define CSTRING_E		    "E"
+#define CSTRING_F		    "F"
+#define CSTRING_G		    "G"
+#define CSTRING_H		    "H"
+
 #define	TEST			   "ÖĞ»ªÈËÃñ¹²ºÍ¹úÈËGB2312"
 #define GGG			   '±Ú'
 #endif
diff --git a/src/EVA11/main.cpp b/src/EVA11/main.cpp
index 7962c70..a9a6442 100644
--- a/src/EVA11/main.cpp
+++ b/src/EVA11/main.cpp
@@ -358,8 +358,8 @@ void Signal_Interrupt(int n,siginfo_t *psiginfo,void *myact)
 main ( int argc, char *argv[] )
 {
 	struct sigaction act;  
-	sigemptyset(&act.sa_mask);     			/* * æ¸…ç©ºé˜»å¡ä¿¡å· **/  
-	act.sa_flags = SA_SIGINFO;     			/* * è®¾ç½®SA_SIGINFO è¡¨ç¤ºä¼ é€’é™„åŠ ä¿¡æ¯åˆ°è§¦å‘å‡½æ•° **/  
+	sigemptyset(&act.sa_mask);     				/* * æ¸…ç©ºé˜»å¡ä¿¡å· **/  
+	act.sa_flags = SA_SIGINFO;     				/* * è®¾ç½®SA_SIGINFO è¡¨ç¤ºä¼ é€’é™„åŠ ä¿¡æ¯åˆ°è§¦å‘å‡½æ•° **/  
 	act.sa_sigaction = Signal_Interrupt;  
 	if	( sigaction(SIGINT,&act,NULL) < 0 )  
 	{
-- 
1.8.5.1

