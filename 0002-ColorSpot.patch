From 4a2dd26c4e51841bb1dd7a825f5eb34da068824d Mon Sep 17 00:00:00 2001
From: kevin <kevin.wang2004@hotmail.com>
Date: Tue, 8 Apr 2014 17:21:55 +0800
Subject: [PATCH 2/4] =?UTF-8?q?=E5=B0=86ColorSpot=E6=98=BE=E7=A4=BA?=
 =?UTF-8?q?=E7=8A=B6=E6=80=81=E5=8F=98=E6=88=90=E9=80=9A=E9=81=93=E6=95=B0?=
 =?UTF-8?q?=E7=9B=AE=E5=8F=AF=E8=B0=83=E6=95=B4?=
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

---
 README                                  |  1 +
 src/EVA11/base/CZKPanel.cpp             | 22 +++++++++++++++++++++
 src/EVA11/base/CZKPanel.h               |  2 ++
 src/EVA11/base/ColorPanel.cpp           | 20 ++++++++++---------
 src/EVA11/base/DetectView.cpp           |  4 ----
 src/EVA11/base/DetectView.h             |  1 -
 src/EVA11/base/Global.cpp               |  3 +++
 src/EVA11/base/Global.h                 | 11 ++++++-----
 src/EVA11/base/KFInterface.cpp          |  1 -
 src/EVA11/base/KFInterface.h            |  1 -
 src/EVA11/base/Language/Language.cpp    |  4 ++++
 src/EVA11/base/Language/ProjectGBText.h | 26 +++++++++++++++----------
 src/EVA11/base/Mainwin.cpp              | 14 ++++++++++++--
 src/EVA11/base/OZKPanel.cpp             | 30 +++++++++++++++++++++++++++++
 src/EVA11/base/OZKPanel.h               |  2 ++
 src/EVA11/base/Process.cpp              | 25 ++++++++++++++++++++++--
 src/EVA11/base/XMLManage.cpp            | 34 +++++++++++++++++++++++----------
 src/EVA11/base/XMLManage.h              |  3 +++
 src/EVA11/base/ZKPanel.cpp              |  2 +-
 19 files changed, 160 insertions(+), 46 deletions(-)

diff --git a/README b/README
index 340821c..d4cfaa0 100644
--- a/README
+++ b/README
@@ -1,4 +1,5 @@
 è¯¥å·¥ç¨‹ç›®å½•é‡æ–°åˆ›å»º
+
 			2012.12.16
 
 å…³äºŽLinuxå†…æ ¸ç‰ˆæœ¬çš„é—®é¢˜è¯´æ˜Ž
diff --git a/src/EVA11/base/CZKPanel.cpp b/src/EVA11/base/CZKPanel.cpp
index dbc2908..5145873 100644
--- a/src/EVA11/base/CZKPanel.cpp
+++ b/src/EVA11/base/CZKPanel.cpp
@@ -745,6 +745,28 @@ int CZKPanel::Key_NR4_Fun(Graphic& g,int sub)         // degree
 	Refresh_AMP_PHA(g);
 	return 0;
 }
+int CZKPanel::Key_NL5_Fun(Graphic& g,int sub)         // clean buffer 
+{
+	Language* m_pl = Language::Instance();
+	Msgbox *ms = new Msgbox(200,170,260,100,m_pl->GetText(CLEANBUF),Msgbox::MSG_OKCANCEL);
+	ms->Set_Color(Msgbox::MSG_COLORTYPE_BG,g_BUBGNO_CO);
+	ms->Set_Color(Msgbox::MSG_COLORTYPE_FG,g_BUTXNO_CO);
+	if ( ms->Showme(g) == false )
+	{
+		delete ms;
+		ms = NULL;
+		return 0;
+	}
+	delete ms;
+	ms = NULL;
+	m_Bufbar->Clean_Buffer_Bar(g);
+	return 0;
+
+}
+int CZKPanel::Key_NR5_Fun(Graphic& g,int sub)         // clean buffer 
+{
+	return Key_NL5_Fun(g,sub);
+}
 
 /* 
  * ===  FUNCTION  ======================================================================
diff --git a/src/EVA11/base/CZKPanel.h b/src/EVA11/base/CZKPanel.h
index a4e9a19..d79e2ad 100644
--- a/src/EVA11/base/CZKPanel.h
+++ b/src/EVA11/base/CZKPanel.h
@@ -36,6 +36,8 @@ class CZKPanel : public DZKPanel
 		virtual	int Key_NR3_Fun(Graphic& g,int sub=1);
 		virtual	int Key_NL4_Fun(Graphic& g,int sub=1);
 		virtual	int Key_NR4_Fun(Graphic& g,int sub=1);
+		virtual	int Key_NL5_Fun(Graphic& g,int sub=1);
+		virtual	int Key_NR5_Fun(Graphic& g,int sub=1);
 
 		virtual int Key_Enter_Fun(Graphic& g);
 		virtual int Key_F2_Fun(Graphic& g);
diff --git a/src/EVA11/base/ColorPanel.cpp b/src/EVA11/base/ColorPanel.cpp
index 98e6808..8c42669 100644
--- a/src/EVA11/base/ColorPanel.cpp
+++ b/src/EVA11/base/ColorPanel.cpp
@@ -68,7 +68,7 @@ void ColorPanel::Init_GUI(Graphic& g)
 	m_Colorscan->Set_Color(Basescreen::LA_GRID_COLOR,g_BUBGNO_CO);
 	m_Colorscan->Set_Color(Basescreen::LA_POINT_COLOR,g_SCTX_CO);
 	m_Colorscan->Set_Color(Basescreen::LA_FOCUS_COLOR,g_SCTX_CO);
-	m_Colorscan->Init_Color_Scan_Parameters(Global::CHANCOUNT);
+	m_Colorscan->Init_Color_Scan_Parameters(m_gp->ColorSpotScanChannels);
 
 	m_Color3Dscan = new Color3DScan(2,2+24,530,393);
 	m_Color3Dscan->Set_Color(Basescreen::LA_FG_COLOR,g_BUTXNO_CO);
@@ -76,7 +76,7 @@ void ColorPanel::Init_GUI(Graphic& g)
 	m_Color3Dscan->Set_Color(Basescreen::LA_GRID_COLOR,g_BUBGNO_CO);
 	m_Color3Dscan->Set_Color(Basescreen::LA_POINT_COLOR,g_SCTX_CO);
 	m_Color3Dscan->Set_Color(Basescreen::LA_FOCUS_COLOR,g_SCTX_CO);
-	m_Color3Dscan->Init_Color_Scan_Parameters(Global::CHANCOUNT);
+	m_Color3Dscan->Init_Color_Scan_Parameters(m_gp->ColorSpotScanChannels);
 	m_Color3Dscan->Set_Fact_Value(m_Colorbar->Get_IndexCount());
 
 	Global *gp = Global::Instance();
@@ -141,11 +141,13 @@ void ColorPanel::Drawme(Graphic& g,bool flag)
 	{
 		m_Colorscan->Set_ScanSpeed_Value(m_gp->ColorSpotScanSpeed);
 		m_Colorscan->Drawme(g,flag);
+		m_Colorscan->Init_Color_Scan_Parameters(m_gp->ColorSpotScanChannels);
 	}
 	else
 	{
 		m_Color3Dscan->Set_ScanSpeed_Value(m_gp->ColorSpotScanSpeed);
 		m_Color3Dscan->Drawme(g,flag);
+		m_Color3Dscan->Init_Color_Scan_Parameters(m_gp->ColorSpotScanChannels);
 	}
 
 	m_Colorbar->Drawme(g,flag);
@@ -171,7 +173,7 @@ int  ColorPanel::Loop_Panel(Graphic& g)
 			m_DataProcess->Get_Data(m_RawBuf);
 			if 	( m_gp->ColorSpotDispMode == 0 )
 			{
-				for ( int i=0;i<Global::CHANCOUNT;i++ )
+				for ( int i=0;i<m_gp->ColorSpotScanChannels;i++ )
 				{
 					m_Colorscan->Draw_Data_On_Scan(g,i,m_Colorbar->Mapping_Color(m_RawBuf[i]));
 				}
@@ -180,7 +182,7 @@ int  ColorPanel::Loop_Panel(Graphic& g)
 			{
 				short color;
 				int colorindex;
-				for ( int i=0;i<Global::CHANCOUNT;i++ )
+				for ( int i=0;i<m_gp->ColorSpotScanChannels;i++ )
 				{
 					m_Colorbar->Mapping_Color_Value(m_RawBuf[i],color,colorindex);
 					m_Color3Dscan->Draw_Data_On_Scan(g,i,color,colorindex);
@@ -199,7 +201,7 @@ int  ColorPanel::Loop_Panel(Graphic& g)
 
 			if 	( m_gp->ColorSpotDispMode == 0 )
 			{
-				for ( int i=0;i<Global::CHANCOUNT;i++ )
+				for ( int i=0;i<m_gp->ColorSpotScanChannels;i++ )
 				{
 					m_Colorscan->Draw_Data_On_Scan(g,i,m_Colorbar->Mapping_Color(m_RawBuf[i]));
 				}
@@ -208,7 +210,7 @@ int  ColorPanel::Loop_Panel(Graphic& g)
 			{
 				short color;
 				int colorindex;
-				for ( int i=0;i<Global::CHANCOUNT;i++ )
+				for ( int i=0;i<m_gp->ColorSpotScanChannels;i++ )
 				{
 					m_Colorbar->Mapping_Color_Value(m_RawBuf[i],color,colorindex);
 					m_Color3Dscan->Draw_Data_On_Scan(g,i,color,colorindex);
@@ -260,12 +262,12 @@ int ColorPanel::Key_F2_Fun(Graphic& g)
 	if 	( m_gp->ColorSpotDispMode == 0 )
 	{
 		m_Colorscan->Drawme(g);
-		m_Colorscan->Init_Color_Scan_Parameters(Global::CHANCOUNT);
+		m_Colorscan->Init_Color_Scan_Parameters(m_gp->ColorSpotScanChannels);
 	}
 	else
 	{
 		m_Color3Dscan->Drawme(g);
-		m_Color3Dscan->Init_Color_Scan_Parameters(Global::CHANCOUNT);
+		m_Color3Dscan->Init_Color_Scan_Parameters(m_gp->ColorSpotScanChannels);
 	}
 
 	m_DataProcess->Reset_InTimer();
@@ -319,7 +321,7 @@ void ColorPanel::Switch_Panel()
 	Device* device = Device::Instance();
 	device->Write_Para_Func(Device::NORMAL);
 
-	for ( int ch=0;ch<Global::CHANCOUNT;ch++ )
+	for ( int ch=0;ch<m_gp->ColorSpotScanChannels;ch++ )
 	{
 		m_gp->ProbeFun[ch] = 1;			// ECT
 		device->Write_Para_SignalID(ch,m_gp->ProbeFun[ch],m_gp->FreqIndex[ch]+1);
diff --git a/src/EVA11/base/DetectView.cpp b/src/EVA11/base/DetectView.cpp
index e8e8f2f..809fd51 100644
--- a/src/EVA11/base/DetectView.cpp
+++ b/src/EVA11/base/DetectView.cpp
@@ -174,10 +174,6 @@ int DetectView::Key_F6_Fun(Graphic& g)
 {
 	return m_Panel[m_PanelType]->Key_F6_Fun(g);
 }
-int DetectView::Key_F7_Fun(Graphic& g)
-{
-	return m_Panel[m_PanelType]->Key_F7_Fun(g);
-}
 
 int DetectView::Key_Enter_Fun(Graphic& g)
 {
diff --git a/src/EVA11/base/DetectView.h b/src/EVA11/base/DetectView.h
index f787854..dacb934 100644
--- a/src/EVA11/base/DetectView.h
+++ b/src/EVA11/base/DetectView.h
@@ -40,7 +40,6 @@ class DetectView : public IView
 		virtual int Key_F4_Fun(Graphic& g);
 		virtual int Key_F5_Fun(Graphic& g);
 		virtual int Key_F6_Fun(Graphic& g);
-		virtual int Key_F7_Fun(Graphic& g);
 
 		virtual	int Key_NL1_Fun(Graphic& g,int sub=1);
 		virtual	int Key_NR1_Fun(Graphic& g,int sub=1);
diff --git a/src/EVA11/base/Global.cpp b/src/EVA11/base/Global.cpp
index d82db07..a1b03b7 100644
--- a/src/EVA11/base/Global.cpp
+++ b/src/EVA11/base/Global.cpp
@@ -210,6 +210,7 @@ void Global::Init_Global_Variables()
 	ColorSpotFreqIndex   = 0;
 	ColorSpotDispMode    = 0;
 	ColorSpotScanSpeed   = 36;
+	ColorSpotScanChannels= 32;
 
 	SAlarmType	     = 3;
 	for ( int i=0;i<3;i++ )
@@ -427,6 +428,7 @@ std::ofstream& operator<<(std::ofstream& oo,const Global& ob)
 	oo<<ob.ColorSpotFreqIndex<<' ';
 	oo<<ob.ColorSpotDispMode<<' ';
 	oo<<ob.ColorSpotScanSpeed<<' ';
+	oo<<ob.ColorSpotScanChannels<<' ';
 
 	oo<<ob.SAlarmType<<' ';
 	for ( int i=0;i<3;i++ )
@@ -615,6 +617,7 @@ std::ifstream& operator>>(std::ifstream& io,Global& ob)
 	io>>ob.ColorSpotFreqIndex;
 	io>>ob.ColorSpotDispMode;
 	io>>ob.ColorSpotScanSpeed;
+	io>>ob.ColorSpotScanChannels;
 
 	io>>ob.SAlarmType;
 	for ( int i=0;i<3;i++ )
diff --git a/src/EVA11/base/Global.h b/src/EVA11/base/Global.h
index 31ef54a..10a4f6a 100644
--- a/src/EVA11/base/Global.h
+++ b/src/EVA11/base/Global.h
@@ -45,11 +45,11 @@ class Global
 
 		void Calculate_Gain();
 	public:
-		static int const 	CHANCOUNT           = 128;
-		static int const 	MIXCOUNT            = 1;
-		static int const 	FREQCOUNT           = 4;
-		static int const 	SCREENCOUNT2        = 2;
-		static int const 	CROSSCOUNT	    = 8;
+		enum { CHANCOUNT     =   128 };
+	        enum { MIXCOUNT      =   1   };
+		enum { FREQCOUNT     =   4   };
+		enum { SCREENCOUNT2  =   2   };
+		enum { CROSSCOUNT    =   8   };
 
 		/* ---------- need to save ---------- */
 
@@ -111,6 +111,7 @@ class Global
 		int			ColorSpotFreqIndex;   /* only used for colorspot display mode */
 		int			ColorSpotDispMode;
 		int			ColorSpotScanSpeed;
+		int                     ColorSpotScanChannels;/* Display how many channels of the device display */
 
 		int			SAlarmType;	      /* 0: Amp  1: Half Amp  2: Rect 3: close */
 		int			SAlarmCount[3];
diff --git a/src/EVA11/base/KFInterface.cpp b/src/EVA11/base/KFInterface.cpp
index ee071b2..0ebeb54 100644
--- a/src/EVA11/base/KFInterface.cpp
+++ b/src/EVA11/base/KFInterface.cpp
@@ -33,7 +33,6 @@ int BaseKFInterface::Key_F3_Fun(Graphic& g){return 0;}
 int BaseKFInterface::Key_F4_Fun(Graphic& g){return 0;}
 int BaseKFInterface::Key_F5_Fun(Graphic& g){return 0;}
 int BaseKFInterface::Key_F6_Fun(Graphic& g){return 0;}
-int BaseKFInterface::Key_F7_Fun(Graphic& g){return 0;}
                                            
 DetectKFInterface::DetectKFInterface()
 {
diff --git a/src/EVA11/base/KFInterface.h b/src/EVA11/base/KFInterface.h
index 5ee6c55..beef0df 100644
--- a/src/EVA11/base/KFInterface.h
+++ b/src/EVA11/base/KFInterface.h
@@ -34,7 +34,6 @@ class BaseKFInterface
 		virtual int Key_F4_Fun(Graphic& g);
 		virtual int Key_F5_Fun(Graphic& g);
 		virtual int Key_F6_Fun(Graphic& g);
-		virtual int Key_F7_Fun(Graphic& g);
 };
 
 class DetectKFInterface
diff --git a/src/EVA11/base/Language/Language.cpp b/src/EVA11/base/Language/Language.cpp
index 222daf6..756ad9f 100644
--- a/src/EVA11/base/Language/Language.cpp
+++ b/src/EVA11/base/Language/Language.cpp
@@ -470,6 +470,8 @@ char const *Language::Get_EN_Text(int index)
 			return NORMAL_CHAN_EN;
 		case CLEANBUFFER:
 			return CLEANBUFFER_EN;
+		case CHANNELSCOUNT:
+			return CHANNELSCOUNT_EN;
 		default:
 			return NONE_EN;
 	}
@@ -894,6 +896,8 @@ char const *Language::Get_CN_Text(int index)
 			return NORMAL_CHAN_CN;
 		case CLEANBUFFER:
 			return CLEANBUFFER_CN;
+		case CHANNELSCOUNT:
+			return CHANNELSCOUNT_CN;
 		default:
 			return NONE_CN;
 	}
diff --git a/src/EVA11/base/Language/ProjectGBText.h b/src/EVA11/base/Language/ProjectGBText.h
index 7b4e1f7..1f132f5 100644
--- a/src/EVA11/base/Language/ProjectGBText.h
+++ b/src/EVA11/base/Language/ProjectGBText.h
@@ -26,7 +26,7 @@
 #define DEBUG_CN  		    "µ÷ÊÔ"
 #define ALARM_CN   		    "±¨¾¯"
 #define ANALYZE_CN 		    "·ÖÎö"
-#define LAYOUT_CN                   "¹¦ÄÜ" 
+#define LAYOUT_CN                   "¹¦ÄÜ"
 #define OTHERS_CN  		    "ÆäËü"
 
 #define PREVIOUSE_CN                "ÉÏÒÆ"
@@ -40,8 +40,8 @@
 #define SUBTITLE_CN                 "²ÎÊýÑ¡Ôñ"
 #define MAINBUTTON_CN               "Í¨ÓÃÎÐÁ÷¼ì²â"
 #define RESERVE_CN                  "Ô¤Áô"
-#define	CANCEL_CN		    "È¡Ïû"	 
-#define COMFIRMEXIT_CN		    "ÄúÈ·ÈÏÒªÍË³öÂð£¿" 
+#define	CANCEL_CN		    "È¡Ïû"
+#define COMFIRMEXIT_CN		    "ÄúÈ·ÈÏÒªÍË³öÂð£¿"
 #define INFORMESG09_CN              " ´íÎó: Ó²¼þ´íÎó£¬Çë¹Ø»ú¼ì²é£¡"
 #define INFORMESG08_CN              "µç³Ø¼´½«ºÄ¾¡£¬Çë¾¡¿ì±£´æ¹Ø»ú£¡"
 
@@ -201,7 +201,7 @@
 #define	DEFAULT_CN		    "Ä¬ÈÏ²ÎÊý"
 #define	RESTORE_CN		    "»Ö¸´"
 #define RESTOREDEFAULT_CN	    "ÊÇ·ñ»Ö¸´³ö³§ÉèÖÃ?"
-#define REBOOTMSG_CN		    "²ÎÊý»Ö¸´Íê³É£¬ÇëÖØÐÂÆô¶¯!"	
+#define REBOOTMSG_CN		    "²ÎÊý»Ö¸´Íê³É£¬ÇëÖØÐÂÆô¶¯!"
 #define	CLEANBUF_CN		    "ÊÇ·ñÇå¿ÕÊý¾Ý»º³åÇø?"
 
 #define	RUNTIME_CN		    "ÔËÐÐÊ±¼ä"
@@ -285,6 +285,8 @@
 
 #define CLEANBUFFER_CN		    "Çå³ý»º³å"
 
+#define CHANNELSCOUNT_CN            "Í¨µÀÊýÁ¿"
+
 #define	NONE_CN			    "  "
 /* ********************************************************************  */
 
@@ -309,7 +311,7 @@
 #define SUBTITLE_EN                 "Sel. Para."
 #define MAINBUTTON_EN               "Standard Testing"
 #define RESERVE_EN                  "Reserve"
-#define	CANCEL_EN		    "Cancel"	 
+#define	CANCEL_EN		    "Cancel"
 #define COMFIRMEXIT_EN		    "Do you want to quit?"
 #define INFORMESG08_EN              "Discharge Off Soon, Pls. Save!"
 #define INFORMESG09_EN              "Hardware Error,Shutdown&Check!"
@@ -468,7 +470,7 @@
 #define	DEFAULT_EN		    "Def.Val."
 #define	RESTORE_EN		    "Restore"
 #define RESTOREDEFAULT_EN	    "Restore to Default Value?"
-#define REBOOTMSG_EN		    "Restore Parameters OK! Reboot App!"	
+#define REBOOTMSG_EN		    "Restore Parameters OK! Reboot App!"
 #define	CLEANBUF_EN		    "Clean Up Data Buffer?"
 #define	RUNTIME_EN		    "Run Time"
 #define	KEYBEEP_EN		    "Key Beep"
@@ -550,6 +552,8 @@
 #define NORMAL_CHAN_EN		    "Normal Chan."
 #define CLEANBUFFER_EN		    "Clean Buffer"
 
+#define CHANNELSCOUNT_EN            "Channels Count"
+
 #define	NONE_EN			    "  "
 /* ********************************************************************  */
 
@@ -659,8 +663,8 @@
 
 #define DZKDISPLAY		    87
 
-#define DATE			    88	
-#define TIME			    89	
+#define DATE			    88
+#define TIME			    89
 #define VERSION		   	    90 
 
 #define ABOUTMSG1 		    91
@@ -744,7 +748,7 @@
 #define SHUTDOWNMSG1		    152
 #define SHUTDOWNMSG2                153
 #define TIMESCALE		    154
-#define TIMESCALESPEED	    	    155	
+#define TIMESCALESPEED	    	    155
 #define MIXINGINFO1                 156
 
 #define PRIFREQ			    157
@@ -782,7 +786,7 @@
 #define PARASYNC		    180
 #define PARASYNCCOMFIRM		    181
 
-#define RESBALACE		    182	
+#define RESBALACE		    182
 #define ADRIVE 		    	    183
 #define BDRIVE 		            184 
 #define APICK 		  	    185 
@@ -817,6 +821,8 @@
 
 #define CLEANBUFFER		    207
 
+#define CHANNELSCOUNT		    208
+
 #define	NONE			    999
 
 #endif
diff --git a/src/EVA11/base/Mainwin.cpp b/src/EVA11/base/Mainwin.cpp
index bd26661..3f94176 100644
--- a/src/EVA11/base/Mainwin.cpp
+++ b/src/EVA11/base/Mainwin.cpp
@@ -877,6 +877,7 @@ void Mainwin::Refresh_Normal_Label_Content_1_OZKPanel(Graphic& g,int sub)
 							break;
 
 						case 3:
+						case 4:
 							sprintf(m_Msg,"%s",m_pl->GetText(EXCUTE));
 							break;
 
@@ -938,7 +939,7 @@ void Mainwin::Refresh_Normal_Label_Content_1_CZKPanel(Graphic& g,int sub)
 								sprintf(m_Msg,"%d DEG",m_gp->MixDegree[m_gp->ScrSigM[m_gp->ScrSigFocus]-2]);
 							break;
 						case 4:
-								sprintf(m_Msg,"S3-S4");
+							sprintf(m_Msg,m_pl->GetText(EXCUTE));
 							break;
 						case 5:
 							sprintf(m_Msg,"%.1f dB",m_gp->Gain[m_gp->AScanMapChan[0]]/static_cast<float>(10));  // always m_gp->AScanMapChan[0]
@@ -1066,6 +1067,9 @@ void Mainwin::Refresh_Normal_Label_Content_2_ColorPanel(Graphic& g,int sub)
 							else if ( m_gp->ColorSpotSampleType == 1 )
 								sprintf(m_Msg,"%lld",m_gp->ColorSPotSampOutPuls);
 							break;
+						case 2:
+							sprintf(m_Msg,"%d",m_gp->ColorSpotScanChannels);
+							break;
 						case 5:
 							if 	( m_gp->ColorSpotDispMode == 0 )
 								sprintf(m_Msg,"%s",m_pl->GetText(DISPMOD_2D));
@@ -2468,6 +2472,9 @@ const char*Mainwin::Get_Normal_Text_1_OZKPanel(int normal,int sub)
 					case 3:
 						return m_pl->GetText(PARASYNC);
 						break;
+					case 4:
+						return m_pl->GetText(CLEANBUFFER);
+						break;
 					default:	
 						return m_pl->GetText(NONE);
 						break;
@@ -2499,7 +2506,7 @@ const char*Mainwin::Get_Normal_Text_1_CZKPanel(int normal,int sub)
 						return m_pl->GetText(PHASE);
 						break;
 					case 4:
-						return m_pl->GetText(ASCANCHAN);
+						return m_pl->GetText(CLEANBUFFER);
 						break;
 					case 5:
 						return m_pl->GetText(EMSGAIN);
@@ -2585,6 +2592,9 @@ const char*Mainwin::Get_Normal_Text_2_ColorPanel(int normal,int sub)
 						else if ( m_gp->ColorSpotSampleType == 1 )
 							return m_pl->GetText(SAMPPLUS);
 						break;
+					case 2:
+						return m_pl->GetText(CHANNELSCOUNT);
+						break;
 					case 5:
 						return m_pl->GetText(COLORSPOTDM);
 						break;
diff --git a/src/EVA11/base/OZKPanel.cpp b/src/EVA11/base/OZKPanel.cpp
index ab9549e..ecb35c4 100644
--- a/src/EVA11/base/OZKPanel.cpp
+++ b/src/EVA11/base/OZKPanel.cpp
@@ -40,6 +40,8 @@
 
 #include 	"LimitManage.h"
 
+#include 	"Msgbox.h"
+
 OZKPanel::OZKPanel (int x,int y,int width,int heigh)
 	: BasePanel(x,y,width,heigh)
 {
@@ -390,30 +392,35 @@ int OZKPanel::Key_NL2_Fun(Graphic& g,int sub)
 {
 	Refresh_Gain_Rotation();
 	m_labMsg[m_gp->ScopeChan]->Drawme(g,true);
+	return 0;
 }
 
 int OZKPanel::Key_NR2_Fun(Graphic& g,int sub)
 {
 	Refresh_Gain_Rotation();
 	m_labMsg[m_gp->ScopeChan]->Drawme(g,true);
+	return 0;
 }
 
 int OZKPanel::Key_NL3_Fun(Graphic& g,int sub)
 {
 	Refresh_Gain_Rotation();
 	m_labMsg[m_gp->ScopeChan]->Drawme(g,true);
+	return 0;
 }
 
 int OZKPanel::Key_NR3_Fun(Graphic& g,int sub)
 {
 	Refresh_Gain_Rotation();
 	m_labMsg[m_gp->ScopeChan]->Drawme(g,true);
+	return 0;
 }
 int OZKPanel::Key_NL4_Fun(Graphic& g,int sub)
 {
 	Refresh_Gain_Rotation();
 	for ( int i=0;i<m_cMAXScreenCount;i++ )
 		m_labMsg[i]->Drawme(g,true);
+	return 0;
 }
 
 int OZKPanel::Key_NR4_Fun(Graphic& g,int sub)
@@ -421,6 +428,29 @@ int OZKPanel::Key_NR4_Fun(Graphic& g,int sub)
 	Refresh_Gain_Rotation();
 	for ( int i=0;i<m_cMAXScreenCount;i++ )
 		m_labMsg[i]->Drawme(g,true);
+	return 0;
+}
+int OZKPanel::Key_NL5_Fun(Graphic& g,int sub)
+{
+	Language* m_pl = Language::Instance();
+	Msgbox *ms = new Msgbox(200,170,260,100,m_pl->GetText(CLEANBUF),Msgbox::MSG_OKCANCEL);
+	ms->Set_Color(Msgbox::MSG_COLORTYPE_BG,g_BUBGNO_CO);
+	ms->Set_Color(Msgbox::MSG_COLORTYPE_FG,g_BUTXNO_CO);
+	if ( ms->Showme(g) == false )
+	{
+		delete ms;
+		ms = NULL;
+		return 0;
+	}
+	delete ms;
+	ms = NULL;
+	m_Bufbar->Clean_Buffer_Bar(g);
+	return 0;
+}
+
+int OZKPanel::Key_NR5_Fun(Graphic& g,int sub)
+{
+	return Key_NL5_Fun(g,sub);
 }
 
 /* 
diff --git a/src/EVA11/base/OZKPanel.h b/src/EVA11/base/OZKPanel.h
index 27152b9..d03ed9d 100644
--- a/src/EVA11/base/OZKPanel.h
+++ b/src/EVA11/base/OZKPanel.h
@@ -42,6 +42,8 @@ class OZKPanel : public BasePanel
 		virtual	int Key_NR3_Fun(Graphic& g,int sub=1);
 		virtual	int Key_NL4_Fun(Graphic& g,int sub=1);
 		virtual	int Key_NR4_Fun(Graphic& g,int sub=1);
+		virtual	int Key_NL5_Fun(Graphic& g,int sub=1);
+		virtual	int Key_NR5_Fun(Graphic& g,int sub=1);
 
 
 		virtual int Key_F2_Fun(Graphic& g);
diff --git a/src/EVA11/base/Process.cpp b/src/EVA11/base/Process.cpp
index 24a429f..092dab4 100644
--- a/src/EVA11/base/Process.cpp
+++ b/src/EVA11/base/Process.cpp
@@ -342,8 +342,10 @@ void DetectProcess::Do_Event_OZKPanel(Graphic& g,int sub,int nor,RLKEY key)
 							}
 						}
 						break;
-					case 5: 
+					case 5:
 						{
+							if 	( key == LKEY || key == RKEY )
+								m_mwin->Refresh_Normal_Label_Text(g);
 						}
 						break;
 					case 6: 
@@ -834,7 +836,8 @@ void DetectProcess::Do_Event_CZKPanel(Graphic& g,int sub,int nor,RLKEY key)
 					break;
 				case 5:
 					{
-
+						if 	( key == LKEY || key == RKEY )
+							m_mwin->Refresh_Normal_Label_Text(g);
 					}
 					break;
 				case 6: 
@@ -1044,6 +1047,24 @@ void ParameterProcess::Do_Event_ColorPanel(Graphic& g,int sub,int nor,RLKEY key)
 					break;
 				case 3: 
 					{
+						if 	( key == LKEY )
+						{
+							if 	( m_gp->ColorSpotScanChannels == 32 )
+								m_gp->ColorSpotScanChannels = 128;
+							else if ( m_gp->ColorSpotScanChannels == 64 )
+								m_gp->ColorSpotScanChannels = 32;
+							else if ( m_gp->ColorSpotScanChannels == 128 )
+								m_gp->ColorSpotScanChannels = 64;
+						}
+						else if ( key == RKEY )
+						{
+							if 	( m_gp->ColorSpotScanChannels == 128 )
+								m_gp->ColorSpotScanChannels = 32;
+							else if ( m_gp->ColorSpotScanChannels == 64 )
+								m_gp->ColorSpotScanChannels = 128;
+							else if ( m_gp->ColorSpotScanChannels == 32 )
+								m_gp->ColorSpotScanChannels = 64;
+						}
 					}
 					break;
 				case 4:
diff --git a/src/EVA11/base/XMLManage.cpp b/src/EVA11/base/XMLManage.cpp
index 67f9de6..336a266 100644
--- a/src/EVA11/base/XMLManage.cpp
+++ b/src/EVA11/base/XMLManage.cpp
@@ -17,7 +17,6 @@
  */
 
 #include 	<standard.h>
-
 #include 	"XMLManage.h"
 
 XMLManage::XMLManage ()
@@ -34,8 +33,6 @@ void XMLManage::Test()
 	xmlNodePtr root_node= NULL, pnode = NULL, node = NULL, node1 = NULL;
 	doc = xmlNewDoc(BAD_CAST "1.0");
 
-
-
 	root_node = xmlNewNode(NULL, BAD_CAST "rootnode");
 	xmlDocSetRootElement(doc, root_node);
 //	xmlNewProp(root_node,BAD_CAST "version", BAD_CAST "2.0");
@@ -45,12 +42,10 @@ void XMLManage::Test()
 	xmlAddChild(root_node,pnode);
 	xmlNewChild(pnode, NULL, BAD_CAST "å­å­èŠ‚ç‚¹11",BAD_CAST "å­å­èŠ‚ç‚¹11çš„å†…å®¹");
 
-
 	xmlNewChild(root_node, NULL, BAD_CAST "å­èŠ‚ç‚¹2",BAD_CAST "å­èŠ‚ç‚¹2çš„å†…å®¹");
 	node=xmlNewChild(root_node,NULL, BAD_CAST "å­èŠ‚ç‚¹3", BAD_CAST"å­èŠ‚ç‚¹3çš„å†…å®¹");
 	xmlNewChild(node, NULL, BAD_CAST "å­å­èŠ‚ç‚¹13",BAD_CAST "å­å­èŠ‚ç‚¹13çš„å†…å®¹");
 
-
 //	xmlAddChild(root_node,node);
 //
 //	node =xmlNewNode(NULL, BAD_CAST "å­èŠ‚ç‚¹3");
@@ -62,10 +57,6 @@ void XMLManage::Test()
 //	node=xmlNewChild(node1,NULL, BAD_CAST "å­å­èŠ‚ç‚¹1", BAD_CAST"å­å­èŠ‚ç‚¹1çš„å†…å®¹");
 //	xmlAddChild(node1,node);
 
-
-
-
-
 	xmlSaveFormatFileEnc("test.xml", doc, "UTF-8", 1);
 	xmlFreeDoc(doc);
 	xmlCleanupParser();
@@ -94,7 +85,6 @@ void XMLManage::Restore_Test()
 			printf ( "root node: %s Version:%s\n",root_node->name,version );
 	}
 
-
 	pnode = root_node->xmlChildrenNode;
 
 	char n=0;
@@ -111,3 +101,27 @@ void XMLManage::Restore_Test()
 	xmlCleanupParser();
 	xmlMemoryDump();
 }
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Save_Parameters
+ *  Description:  Save the parametres into XML file 
+ * =====================================================================================
+ */
+void XMLManage::Save_Parameters()
+{
+
+
+}
+
+/* 
+ * ===  FUNCTION  ======================================================================
+ *         Name:  Load_Parameters
+ *  Description:  Load the parameters into XML file 
+ * =====================================================================================
+ */
+void XMLManage::Load_Parameters()
+{
+
+
+}
diff --git a/src/EVA11/base/XMLManage.h b/src/EVA11/base/XMLManage.h
index 5527609..923ae5d 100644
--- a/src/EVA11/base/XMLManage.h
+++ b/src/EVA11/base/XMLManage.h
@@ -27,9 +27,12 @@ class XMLManage
 	public:
 		XMLManage ();                             /* constructor */
 		~XMLManage ();                            /* destructor */
+
 		void Test();
 		void Restore_Test();
 
+		void Save_Parameters();			  /* save parameters  */
+		void Load_Parameters();			  /* Load parameters  */
 	protected:
 
 	private:
diff --git a/src/EVA11/base/ZKPanel.cpp b/src/EVA11/base/ZKPanel.cpp
index 0614389..b79b8cf 100644
--- a/src/EVA11/base/ZKPanel.cpp
+++ b/src/EVA11/base/ZKPanel.cpp
@@ -378,7 +378,7 @@ void ZKPanel::Show_Help_System(Graphic& g,int x,int y)
 	font->Text(x+30,y+110,pl->GetText(HELPB1F3));
 	font->Text(x+30,y+130,pl->GetText(HELPB1F4));
 	font->Text(x+30,y+150,pl->GetText(HELPB1F5));
-	font->Text(x+30,y+170,pl->GetText(HELPB1F6));
+//	font->Text(x+30,y+170,pl->GetText(HELPB1F6));
 	font->Text(x+30,y+210,pl->GetText(HELPB1ESC));
 	font->Text(x+30,y+230,pl->GetText(HELPB1ENTER));
 }
-- 
1.8.5.1

